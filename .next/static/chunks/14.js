(window["webpackJsonp_N_E"] = window["webpackJsonp_N_E"] || []).push([[14],{

/***/ "./node_modules/@aws-amplify/ui-components/dist/esm-es5/amplify-chatbot.entry.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/@aws-amplify/ui-components/dist/esm-es5/amplify-chatbot.entry.js ***!
  \***************************************************************************************/
/*! exports provided: amplify_chatbot */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"amplify_chatbot\", function() { return AmplifyChatbot; });\n/* harmony import */ var _index_39969785_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-39969785.js */ \"./node_modules/@aws-amplify/ui-components/dist/esm-es5/index-39969785.js\");\n/* harmony import */ var _aws_amplify_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @aws-amplify/core */ \"./node_modules/@aws-amplify/core/lib-esm/index.js\");\n/* harmony import */ var _aws_amplify_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @aws-amplify/auth */ \"./node_modules/@aws-amplify/auth/lib-esm/index.js\");\n/* harmony import */ var _Translations_392acb9b_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Translations-392acb9b.js */ \"./node_modules/@aws-amplify/ui-components/dist/esm-es5/Translations-392acb9b.js\");\n/* harmony import */ var _constants_d1abe7de_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./constants-d1abe7de.js */ \"./node_modules/@aws-amplify/ui-components/dist/esm-es5/constants-d1abe7de.js\");\n/* harmony import */ var _aws_amplify_interactions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @aws-amplify/interactions */ \"./node_modules/@aws-amplify/interactions/lib-esm/index.js\");\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (undefined && undefined.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\n\n\n\n\n\n\n// AudioRecorder settings\nvar RECORDER_EXPORT_MIME_TYPE = 'application/octet-stream';\nvar DEFAULT_EXPORT_SAMPLE_RATE = 16000;\nvar FFT_SIZE = 2048; // window size in samples for Fast Fourier Transform (FFT)\nvar FFT_MAX_DECIBELS = -10; // maximum power value in the scaling range for the FFT analysis data\nvar FFT_MIN_DECIBELS = -90; // minimum power value in the scaling range for the FFT analysis data\nvar FFT_SMOOTHING_TIME_CONSTANT = 0.85; // averaging constant with the last analysis frame\n/**\n * Merges multiple buffers into one.\n */\nvar mergeBuffers = function (bufferArray, recLength) {\n    var result = new Float32Array(recLength);\n    var offset = 0;\n    for (var i = 0; i < bufferArray.length; i++) {\n        result.set(bufferArray[i], offset);\n        offset += bufferArray[i].length;\n    }\n    return result;\n};\n/**\n * Downsamples audio to desired export sample rate.\n */\nvar downsampleBuffer = function (buffer, recordSampleRate, exportSampleRate) {\n    if (exportSampleRate === recordSampleRate) {\n        return buffer;\n    }\n    var sampleRateRatio = recordSampleRate / exportSampleRate;\n    var newLength = Math.round(buffer.length / sampleRateRatio);\n    var result = new Float32Array(newLength);\n    var offsetResult = 0;\n    var offsetBuffer = 0;\n    while (offsetResult < result.length) {\n        var nextOffsetBuffer = Math.round((offsetResult + 1) * sampleRateRatio);\n        var accum = 0, count = 0;\n        for (var i = offsetBuffer; i < nextOffsetBuffer && i < buffer.length; i++) {\n            accum += buffer[i];\n            count++;\n        }\n        result[offsetResult] = accum / count;\n        offsetResult++;\n        offsetBuffer = nextOffsetBuffer;\n    }\n    return result;\n};\n/**\n * converts raw audio values to 16 bit pcm.\n */\nvar floatTo16BitPCM = function (output, offset, input) {\n    var byteOffset = offset;\n    for (var i = 0; i < input.length; i++, byteOffset += 2) {\n        var s = Math.max(-1, Math.min(1, input[i]));\n        output.setInt16(byteOffset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\n    }\n};\n/**\n * Write given strings in big-endian order.\n */\nvar writeString = function (view, offset, string) {\n    for (var i = 0; i < string.length; i++) {\n        view.setUint8(offset + i, string.charCodeAt(i));\n    }\n};\n/**\n * Encodes raw pcm audio into a wav file.\n */\nvar encodeWAV = function (samples, exportSampleRate) {\n    /**\n     * WAV file consists of three parts: RIFF header, WAVE subchunk, and data subchunk. We precompute the size of them.\n     */\n    var audioSize = samples.length * 2; // We use 16-bit samples, so we have (2 * sampleLength) bytes.\n    var fmtSize = 24; // Byte size of the fmt subchunk: 24 bytes that the audio information that we'll set below.\n    var dataSize = 8 + audioSize; // Byte size of the data subchunk: raw sound data plus 8 bytes for the subchunk descriptions.\n    var totalByteSize = 12 + fmtSize + dataSize; // Byte size of the whole file, including the chunk header / descriptor.\n    // create DataView object to write byte values into\n    var buffer = new ArrayBuffer(totalByteSize); // buffer to write the chunk values in.\n    var view = new DataView(buffer);\n    /**\n     * Start writing the .wav file. We write top to bottom, so byte offset (first numeric argument) increases strictly.\n     */\n    // RIFF header\n    writeString(view, 0, 'RIFF'); // At offset 0, write the letters \"RIFF\"\n    view.setUint32(4, fmtSize + dataSize, true); // At offset 4, write the size of fmt and data chunk size combined.\n    writeString(view, 8, 'WAVE'); // At offset 8, write the format type \"WAVE\"\n    // fmt subchunk\n    writeString(view, 12, 'fmt '); //chunkdId 'fmt '\n    view.setUint32(16, fmtSize - 8, true); // fmt subchunk size below this value. We set 8 bytes already, so subtract 8 bytes from fmtSize.\n    view.setUint16(20, 1, true); // Audiio format code, which is 1 for PCM.\n    view.setUint16(22, 1, true); // Number of audio channels. We use mono, ie 1.\n    view.setUint32(24, exportSampleRate, true); // Sample rate of the audio file.\n    view.setUint32(28, exportSampleRate * 2, true); // Data rate, or # of data bytes per second. Since each sample is 2 bytes, this is 2 * sampleRate.\n    view.setUint16(32, 2, true); // block align, # of bytes per sample including all channels, ie. 2 bytes.\n    view.setUint16(34, 16, true); // bits per sample, ie. 16 bits\n    // data subchunk\n    writeString(view, 36, 'data'); // write the chunkId 'data'\n    view.setUint32(40, audioSize, true); // Audio byte size\n    floatTo16BitPCM(view, 44, samples); // raw pcm values then go here.\n    return view;\n};\n/**\n * Given arrays of raw pcm audio, downsamples the audio to desired sample rate and encodes it to a wav audio file.\n *\n * @param recBuffer {Float32Array[]} - 2d float array containing the recorded raw audio\n * @param recLength {number} - total length of recorded audio\n * @param recordSampleRate {number} - sample rate of the recorded audio\n * @param exportSampleRate {number} - desired sample rate of the exported file\n */\nvar exportBuffer = function (recBuffer, recLength, recordSampleRate, exportSampleRate) {\n    var mergedBuffers = mergeBuffers(recBuffer, recLength);\n    var downsampledBuffer = downsampleBuffer(mergedBuffers, recordSampleRate, exportSampleRate);\n    var encodedWav = encodeWAV(downsampledBuffer, exportSampleRate);\n    var audioBlob = new Blob([encodedWav], {\n        type: RECORDER_EXPORT_MIME_TYPE,\n    });\n    return audioBlob;\n};\nvar logger = new _aws_amplify_core__WEBPACK_IMPORTED_MODULE_1__[\"Logger\"]('AudioRecorder');\nvar AudioRecorder = /** @class */ (function () {\n    function AudioRecorder(options) {\n        // input mic stream is stored in a buffer\n        this.streamBuffer = [];\n        this.streamBufferLength = 0;\n        this.recording = false;\n        this.options = options;\n    }\n    /**\n     * This must be called first to enable audio context and request microphone access.\n     * Once access granted, it connects all the necessary audio nodes to the context so that it can begin recording or playing.\n     */\n    AudioRecorder.prototype.init = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!Object(_aws_amplify_core__WEBPACK_IMPORTED_MODULE_1__[\"browserOrNode\"])().isBrowser) return [3 /*break*/, 2];\n                        window.AudioContext = window.AudioContext || window.webkitAudioContext;\n                        this.audioContext = new AudioContext();\n                        return [4 /*yield*/, navigator.mediaDevices\n                                .getUserMedia({ audio: true })\n                                .then(function (stream) {\n                                _this.audioSupported = true;\n                                _this.setupAudioNodes(stream);\n                            })\n                                .catch(function () {\n                                _this.audioSupported = false;\n                                return Promise.reject('Audio is not supported');\n                            })];\n                    case 1:\n                        _a.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        this.audioSupported = false;\n                        return [2 /*return*/, Promise.reject('Audio is not supported')];\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Setup audio nodes after successful `init`.\n     */\n    AudioRecorder.prototype.setupAudioNodes = function (stream) {\n        return __awaiter(this, void 0, void 0, function () {\n            var err_1, sourceNode, processorNode, analyserNode;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        return [4 /*yield*/, this.audioContext.resume()];\n                    case 1:\n                        _a.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        err_1 = _a.sent();\n                        logger.error(err_1);\n                        return [3 /*break*/, 3];\n                    case 3:\n                        sourceNode = this.audioContext.createMediaStreamSource(stream);\n                        processorNode = this.audioContext.createScriptProcessor(4096, 1, 1);\n                        processorNode.onaudioprocess = function (audioProcessingEvent) {\n                            if (!_this.recording)\n                                return;\n                            var stream = audioProcessingEvent.inputBuffer.getChannelData(0);\n                            _this.streamBuffer.push(new Float32Array(stream)); // set to a copy of the stream\n                            _this.streamBufferLength += stream.length;\n                            _this.analyse();\n                        };\n                        analyserNode = this.audioContext.createAnalyser();\n                        analyserNode.minDecibels = FFT_MIN_DECIBELS;\n                        analyserNode.maxDecibels = FFT_MAX_DECIBELS;\n                        analyserNode.smoothingTimeConstant = FFT_SMOOTHING_TIME_CONSTANT;\n                        sourceNode.connect(analyserNode);\n                        analyserNode.connect(processorNode);\n                        processorNode.connect(sourceNode.context.destination);\n                        this.analyserNode = analyserNode;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Start recording audio and listen for silence.\n     *\n     * @param onSilence {SilenceHandler} - called whenever silence is detected\n     * @param visualizer {Visualizer} - called with audio data on each audio process to be used for visualization.\n     */\n    AudioRecorder.prototype.startRecording = function (onSilence, visualizer) {\n        return __awaiter(this, void 0, void 0, function () {\n            var context, err_2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.recording || !this.audioSupported)\n                            return [2 /*return*/];\n                        this.onSilence = onSilence || function () { };\n                        this.visualizer = visualizer || function () { };\n                        context = this.audioContext;\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, context.resume()];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_2 = _a.sent();\n                        logger.error(err_2);\n                        return [3 /*break*/, 4];\n                    case 4:\n                        this.start = Date.now();\n                        this.recording = true;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Pause recording\n     */\n    AudioRecorder.prototype.stopRecording = function () {\n        if (!this.audioSupported)\n            return;\n        this.recording = false;\n    };\n    /**\n     * Pause recording and clear audio buffer\n     */\n    AudioRecorder.prototype.clear = function () {\n        this.stopRecording();\n        this.streamBufferLength = 0;\n        this.streamBuffer = [];\n    };\n    /**\n     * Plays given audioStream with audioContext\n     *\n     * @param buffer {Uint8Array} - audioStream to be played\n     */\n    AudioRecorder.prototype.play = function (buffer) {\n        var _this = this;\n        if (!buffer || !this.audioSupported)\n            return;\n        var myBlob = new Blob([buffer]);\n        return new Promise(function (res, rej) {\n            var fileReader = new FileReader();\n            fileReader.onload = function () {\n                if (_this.playbackSource)\n                    _this.playbackSource.disconnect(); // disconnect previous playback source\n                _this.playbackSource = _this.audioContext.createBufferSource();\n                var successCallback = function (buf) {\n                    _this.playbackSource.buffer = buf;\n                    _this.playbackSource.connect(_this.audioContext.destination);\n                    _this.playbackSource.onended = function () {\n                        return res();\n                    };\n                    _this.playbackSource.start(0);\n                };\n                var errorCallback = function (err) {\n                    return rej(err);\n                };\n                _this.audioContext.decodeAudioData(fileReader.result, successCallback, errorCallback);\n            };\n            fileReader.onerror = function () { return rej(); };\n            fileReader.readAsArrayBuffer(myBlob);\n        });\n    };\n    /**\n     * Stops playing audio if there's a playback source connected.\n     */\n    AudioRecorder.prototype.stop = function () {\n        if (this.playbackSource) {\n            this.playbackSource.stop();\n        }\n    };\n    /**\n     * Called after each audioProcess. Check for silence and give fft time domain data to visualizer.\n     */\n    AudioRecorder.prototype.analyse = function () {\n        if (!this.audioSupported)\n            return;\n        var analyser = this.analyserNode;\n        analyser.fftSize = FFT_SIZE;\n        var bufferLength = analyser.fftSize;\n        var dataArray = new Uint8Array(bufferLength);\n        var amplitude = this.options.amplitude;\n        var time = this.options.time;\n        analyser.getByteTimeDomainData(dataArray);\n        this.visualizer(dataArray, bufferLength);\n        for (var i = 0; i < bufferLength; i++) {\n            // Normalize between -1 and 1.\n            var curr_value_time = dataArray[i] / 128 - 1.0;\n            if (curr_value_time > amplitude || curr_value_time < -1 * amplitude) {\n                this.start = Date.now();\n            }\n        }\n        var newtime = Date.now();\n        var elapsedTime = newtime - this.start;\n        if (elapsedTime > time) {\n            this.onSilence();\n        }\n    };\n    /**\n     * Encodes recorded buffer to a wav file and exports it to a blob.\n     *\n     * @param exportSampleRate {number} - desired sample rate of the exported buffer\n     */\n    AudioRecorder.prototype.exportWAV = function (exportSampleRate) {\n        if (exportSampleRate === void 0) { exportSampleRate = DEFAULT_EXPORT_SAMPLE_RATE; }\n        return __awaiter(this, void 0, void 0, function () {\n            var recordSampleRate, blob;\n            return __generator(this, function (_a) {\n                if (!this.audioSupported)\n                    return [2 /*return*/];\n                recordSampleRate = this.audioContext.sampleRate;\n                blob = exportBuffer(this.streamBuffer, this.streamBufferLength, recordSampleRate, exportSampleRate);\n                this.clear();\n                return [2 /*return*/, blob];\n            });\n        });\n    };\n    return AudioRecorder;\n}());\nvar visualize = function (dataArray, bufferLength, canvas) {\n    if (!canvas)\n        return;\n    if (!Object(_aws_amplify_core__WEBPACK_IMPORTED_MODULE_1__[\"browserOrNode\"])().isBrowser)\n        throw new Error('Visualization is not supported on non-browsers.');\n    var _a = canvas.getBoundingClientRect(), width = _a.width, height = _a.height;\n    // need to update the default canvas width and height\n    canvas.width = width;\n    canvas.height = height;\n    var canvasCtx = canvas.getContext('2d');\n    canvasCtx.fillStyle = 'white';\n    canvasCtx.clearRect(0, 0, width, height);\n    var draw = function () {\n        canvasCtx.fillRect(0, 0, width, height);\n        canvasCtx.lineWidth = 1;\n        var color = getComputedStyle(document.documentElement).getPropertyValue('--amplify-primary-color');\n        canvasCtx.strokeStyle = !color || color === '' ? '#ff9900' : color; // TODO: try separate css variable\n        canvasCtx.beginPath();\n        var sliceWidth = (width * 1.0) / bufferLength;\n        var x = 0;\n        for (var i = 0; i < bufferLength || i % 3 === 0; i++) {\n            var value = dataArray[i] / 128.0;\n            var y = (value * height) / 2;\n            if (i === 0) {\n                canvasCtx.moveTo(x, y);\n            }\n            else {\n                canvasCtx.lineTo(x, y);\n            }\n            x += sliceWidth;\n        }\n        canvasCtx.lineTo(canvas.width, canvas.height / 2);\n        canvasCtx.stroke();\n    };\n    // Register our draw function with requestAnimationFrame.\n    requestAnimationFrame(draw);\n};\nvar amplifyChatbotCss = \".bot .dot{background-color:var(--bot-dot-color)}.user .dot{background-color:var(--user-dot-color)}.dot-flashing{width:2.625rem}.dot-flashing .dot{display:inline-block;width:0.625rem;height:0.625rem;border-radius:10rem;opacity:0.65}.dot-flashing .left{-webkit-animation:dot-flashing 1s infinite alternate;animation:dot-flashing 1s infinite alternate;-webkit-animation-delay:0s;animation-delay:0s}.dot-flashing .middle{margin-left:0.375rem;margin-right:0.375rem;-webkit-animation:dot-flashing 1s infinite linear alternate;animation:dot-flashing 1s infinite linear alternate;-webkit-animation-delay:0.5s;animation-delay:0.5s}.dot-flashing .right{-webkit-animation:dot-flashing 1s infinite alternate;animation:dot-flashing 1s infinite alternate;-webkit-animation-delay:1s;animation-delay:1s}@-webkit-keyframes dot-flashing{0%{opacity:0.65}50%,100%{opacity:0.1}}@keyframes dot-flashing{0%{opacity:0.65}50%,100%{opacity:0.1}}:host{--width:28.75rem;--height:37.5rem;--header-color:var(--amplify-secondary-color);--header-size:var(--amplify-text-lg);--bot-background-color:rgb(230, 230, 230);--bot-text-color:black;--bot-dot-color:var(--bot-text-color);--user-background-color:var(--amplify-blue);--user-text-color:var(--amplify-white);--user-dot-color:var(--user-text-color)}.amplify-chatbot{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-direction:column;flex-direction:column;background-color:var(--background-color);border-radius:0.375rem;-webkit-box-shadow:0.0625rem 0rem 0.25rem 0 rgba(0, 0, 0, 0.15);box-shadow:0.0625rem 0rem 0.25rem 0 rgba(0, 0, 0, 0.15);-webkit-box-sizing:border-box;box-sizing:border-box;font-family:var(--amplify-font-family);margin-bottom:1rem;width:100%;height:var(--height);max-width:var(--width)}@media (min-width: 672px){.amplify-chatbot{width:var(--width)}}.header{padding:1.25rem 0.375rem 1.25rem 0.375rem;color:var(--header-color);font-size:var(--header-size);font-weight:bold;text-align:center;word-wrap:break-word}.body{border-top:0.0625rem solid rgba(0, 0, 0, 0.05);padding:1.5rem 1rem 0 1rem;display:-ms-flexbox;display:flex;-ms-flex-positive:1;flex-grow:1;-ms-flex-direction:column;flex-direction:column;overflow:auto}.bubble{max-width:100%;padding:0.8em 1.4em;text-align:left;word-wrap:break-word;margin-bottom:0.625rem}.bot{margin-right:auto;background-color:var(--bot-background-color);color:var(--bot-text-color);border-radius:1.5rem 1.5rem 1.5rem 0}.user{margin-left:auto;background-color:var(--user-background-color);color:var(--user-text-color);border-radius:1.5rem 1.5rem 0 1.5rem}.footer{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;border-top:0.062rem solid rgba(0, 0, 0, 0.05);padding-right:0.625rem;min-height:3.125rem}.footer amplify-input{--border:none;--margin:0;-ms-flex-positive:1;flex-grow:1}canvas{margin-left:0.625rem;margin-right:0.625rem;-ms-flex-positive:1;flex-grow:1;height:3.125rem}.icon-button{--icon-height:1.25rem;--icon-fill:var(--amplify-primary-color);--padding:0.625rem;--width:auto}\";\n// enum for possible bot states\nvar ChatState;\n(function (ChatState) {\n    ChatState[ChatState[\"Initial\"] = 0] = \"Initial\";\n    ChatState[ChatState[\"Listening\"] = 1] = \"Listening\";\n    ChatState[ChatState[\"SendingText\"] = 2] = \"SendingText\";\n    ChatState[ChatState[\"SendingVoice\"] = 3] = \"SendingVoice\";\n    ChatState[ChatState[\"Error\"] = 4] = \"Error\";\n})(ChatState || (ChatState = {}));\n// Message types\nvar MessageFrom;\n(function (MessageFrom) {\n    MessageFrom[\"Bot\"] = \"bot\";\n    MessageFrom[\"User\"] = \"user\";\n})(MessageFrom || (MessageFrom = {}));\n// Error types\nvar ChatErrorType;\n(function (ChatErrorType) {\n    ChatErrorType[ChatErrorType[\"Recoverable\"] = 0] = \"Recoverable\";\n    ChatErrorType[ChatErrorType[\"Unrecoverable\"] = 1] = \"Unrecoverable\";\n})(ChatErrorType || (ChatErrorType = {}));\nvar AmplifyChatbot = /** @class */ (function () {\n    function class_1(hostRef) {\n        var _this = this;\n        Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"r\"])(this, hostRef);\n        /** Clear messages when conversation finishes */\n        this.clearOnComplete = false;\n        /** Continue listening to users after they send the message */\n        this.conversationModeOn = false;\n        /** Text placed in the top header */\n        this.botTitle = _Translations_392acb9b_js__WEBPACK_IMPORTED_MODULE_3__[\"T\"].CHATBOT_TITLE;\n        /** Whether voice chat is enabled */\n        this.voiceEnabled = false;\n        /** Whether text chat is enabled */\n        this.textEnabled = true;\n        /** Amount of silence (in ms) to wait for */\n        this.silenceTime = 1500;\n        /** Noise threshold between -1 and 1. Anything below is considered a silence. */\n        this.silenceThreshold = 0.2;\n        /** Messages in current session */\n        this.messages = [];\n        /** Text input box value  */\n        this.text = '';\n        /** Current app state */\n        this.chatState = ChatState.Initial;\n        /**\n         * Rendering methods\n         */\n        this.messageJSX = function (messages) {\n            var messageList = messages.map(function (message) { return Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"div\", { class: \"bubble \" + message.from }, message.content); });\n            if (_this.chatState === ChatState.SendingText || _this.chatState === ChatState.SendingVoice) {\n                // if waiting for voice message, show animation on user side because app is waiting for transcript. Else put it on bot side.\n                var client = _this.chatState === ChatState.SendingText ? MessageFrom.Bot : MessageFrom.User;\n                messageList.push(Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"div\", { class: \"bubble \" + client }, Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"div\", { class: \"dot-flashing \" + client }, Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"span\", { class: \"dot left\" }), Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"span\", { class: \"dot middle\" }), Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"span\", { class: \"dot right\" }))));\n            }\n            return messageList;\n        };\n        this.chatCompleted = Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"c\"])(this, \"chatCompleted\", 7);\n    }\n    // Occurs when user presses enter in input box\n    class_1.prototype.submitHandler = function (_event) {\n        this.sendTextMessage();\n    };\n    /**\n     * Lifecycle functions\n     */\n    class_1.prototype.componentWillLoad = function () {\n        if (!_aws_amplify_interactions__WEBPACK_IMPORTED_MODULE_5__[\"Interactions\"] || typeof _aws_amplify_interactions__WEBPACK_IMPORTED_MODULE_5__[\"Interactions\"].onComplete !== 'function') {\n            throw new Error(_constants_d1abe7de_js__WEBPACK_IMPORTED_MODULE_4__[\"d\"]);\n        }\n        this.validateProps();\n    };\n    class_1.prototype.componentDidRender = function () {\n        // scroll to the bottom if necessary\n        var body = this.element.shadowRoot.querySelector('.body');\n        body.scrollTop = body.scrollHeight;\n    };\n    class_1.prototype.validateProps = function () {\n        var _this = this;\n        if (!this.voiceEnabled && !this.textEnabled) {\n            this.setError(_Translations_392acb9b_js__WEBPACK_IMPORTED_MODULE_3__[\"T\"].CHAT_DISABLED_ERROR, ChatErrorType.Unrecoverable);\n            return;\n        }\n        else if (!this.botName) {\n            this.setError(_Translations_392acb9b_js__WEBPACK_IMPORTED_MODULE_3__[\"T\"].NO_BOT_NAME_ERROR, ChatErrorType.Unrecoverable);\n            return;\n        }\n        if (this.welcomeMessage)\n            this.appendToChat(this.welcomeMessage, MessageFrom.Bot);\n        // Initialize AudioRecorder if voice is enabled\n        if (this.voiceEnabled) {\n            this.audioRecorder = new AudioRecorder({\n                time: this.silenceTime,\n                amplitude: this.silenceThreshold,\n            });\n            this.audioRecorder.init().catch(function (err) {\n                _this.setError(err, ChatErrorType.Recoverable);\n            });\n        }\n        // Callback function to be called after chat is completed\n        var onComplete = function (err, data) {\n            _this.chatCompleted.emit({\n                data: data,\n                err: err,\n            });\n            if (_this.clearOnComplete) {\n                _this.reset();\n            }\n            else {\n                _this.chatState = ChatState.Initial;\n            }\n        };\n        try {\n            _aws_amplify_interactions__WEBPACK_IMPORTED_MODULE_5__[\"Interactions\"].onComplete(this.botName, onComplete);\n        }\n        catch (err) {\n            this.setError(err, ChatErrorType.Unrecoverable);\n        }\n    };\n    /**\n     * Handlers\n     */\n    class_1.prototype.handleMicButton = function () {\n        var _this = this;\n        if (this.chatState !== ChatState.Initial)\n            return;\n        this.audioRecorder.stop();\n        this.chatState = ChatState.Listening;\n        this.audioRecorder.startRecording(function () { return _this.handleSilence(); }, function (data, length) { return _this.visualizer(data, length); });\n    };\n    class_1.prototype.handleSilence = function () {\n        var _this = this;\n        this.chatState = ChatState.SendingVoice;\n        this.audioRecorder.stopRecording();\n        this.audioRecorder.exportWAV().then(function (blob) {\n            _this.sendVoiceMessage(blob);\n        });\n    };\n    class_1.prototype.handleTextChange = function (event) {\n        var target = event.target;\n        this.text = target.value;\n    };\n    class_1.prototype.handleCancelButton = function () {\n        this.audioRecorder.clear();\n        this.chatState = ChatState.Initial;\n    };\n    class_1.prototype.handleToastClose = function (errorType) {\n        this.error = undefined; // clear error\n        // if error is recoverable, reset the app state to initial\n        if (errorType === ChatErrorType.Recoverable) {\n            this.chatState = ChatState.Initial;\n        }\n    };\n    /**\n     * Visualization\n     */\n    class_1.prototype.visualizer = function (dataArray, bufferLength) {\n        var canvas = this.element.shadowRoot.querySelector('canvas');\n        visualize(dataArray, bufferLength, canvas);\n    };\n    /**\n     * Interactions helpers\n     */\n    class_1.prototype.sendTextMessage = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var text, response, err_3;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.text.length === 0 || this.chatState !== ChatState.Initial)\n                            return [2 /*return*/];\n                        text = this.text;\n                        this.text = '';\n                        this.appendToChat(text, MessageFrom.User);\n                        this.chatState = ChatState.SendingText;\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, _aws_amplify_interactions__WEBPACK_IMPORTED_MODULE_5__[\"Interactions\"].send(this.botName, text)];\n                    case 2:\n                        response = _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_3 = _a.sent();\n                        this.setError(err_3, ChatErrorType.Recoverable);\n                        return [2 /*return*/];\n                    case 4:\n                        if (response.message) {\n                            this.appendToChat(response.message, MessageFrom.Bot);\n                        }\n                        this.chatState = ChatState.Initial;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    class_1.prototype.sendVoiceMessage = function (audioInput) {\n        return __awaiter(this, void 0, void 0, function () {\n            var interactionsMessage, response, err_4, dialogState;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        interactionsMessage = {\n                            content: audioInput,\n                            options: {\n                                messageType: 'voice',\n                            },\n                        };\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, _aws_amplify_interactions__WEBPACK_IMPORTED_MODULE_5__[\"Interactions\"].send(this.botName, interactionsMessage)];\n                    case 2:\n                        response = _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_4 = _a.sent();\n                        this.setError(err_4, ChatErrorType.Recoverable);\n                        return [2 /*return*/];\n                    case 4:\n                        this.chatState = ChatState.Initial;\n                        dialogState = response.dialogState;\n                        if (response.inputTranscript)\n                            this.appendToChat(response.inputTranscript, MessageFrom.User);\n                        this.appendToChat(response.message, MessageFrom.Bot);\n                        return [4 /*yield*/, this.audioRecorder\n                                .play(response.audioStream)\n                                .then(function () {\n                                // if conversationMode is on, chat is incomplete, and mic button isn't pressed yet, resume listening.\n                                if (_this.conversationModeOn &&\n                                    dialogState !== 'Fulfilled' &&\n                                    dialogState !== 'Failed' &&\n                                    _this.chatState === ChatState.Initial) {\n                                    _this.handleMicButton();\n                                }\n                            })\n                                .catch(function (err) { return _this.setError(err, ChatErrorType.Recoverable); })];\n                    case 5:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    class_1.prototype.appendToChat = function (content, from) {\n        this.messages = __spreadArrays(this.messages, [\n            {\n                content: content,\n                from: from,\n            },\n        ]);\n    };\n    /**\n     * State control methods\n     */\n    class_1.prototype.setError = function (error, errorType) {\n        var message = typeof error === 'string' ? error : error.message;\n        this.chatState = ChatState.Error;\n        this.error = { message: message, errorType: errorType };\n    };\n    class_1.prototype.reset = function () {\n        this.chatState = ChatState.Initial;\n        this.text = '';\n        this.error = undefined;\n        this.messages = [];\n        if (this.welcomeMessage)\n            this.appendToChat(this.welcomeMessage, MessageFrom.Bot);\n        this.audioRecorder && this.audioRecorder.clear();\n    };\n    class_1.prototype.listeningFooterJSX = function () {\n        var _this = this;\n        var visualization = Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"canvas\", { height: \"50\" });\n        var cancelButton = (Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"amplify-button\", { \"data-test\": \"chatbot-cancel-button\", handleButtonClick: function () { return _this.handleCancelButton(); }, class: \"icon-button\", variant: \"icon\", icon: \"ban\" }));\n        return [visualization, cancelButton];\n    };\n    class_1.prototype.footerJSX = function () {\n        var _this = this;\n        if (this.chatState === ChatState.Listening)\n            return this.listeningFooterJSX();\n        var inputPlaceholder = this.textEnabled\n            ? _Translations_392acb9b_js__WEBPACK_IMPORTED_MODULE_3__[\"T\"].TEXT_INPUT_PLACEHOLDER\n            : _Translations_392acb9b_js__WEBPACK_IMPORTED_MODULE_3__[\"T\"].VOICE_INPUT_PLACEHOLDER;\n        var textInput = (Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"amplify-input\", { placeholder: _aws_amplify_core__WEBPACK_IMPORTED_MODULE_1__[\"I18n\"].get(inputPlaceholder), description: \"text\", handleInputChange: function (evt) { return _this.handleTextChange(evt); }, value: this.text, disabled: this.chatState === ChatState.Error || !this.textEnabled }));\n        var micButton = this.voiceEnabled && (Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"amplify-button\", { \"data-test\": \"chatbot-mic-button\", handleButtonClick: function () { return _this.handleMicButton(); }, class: \"icon-button\", variant: \"icon\", icon: \"microphone\", disabled: this.chatState === ChatState.Error || this.chatState !== ChatState.Initial }));\n        var sendButton = this.textEnabled && (Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"amplify-button\", { \"data-test\": \"chatbot-send-button\", class: \"icon-button\", variant: \"icon\", icon: \"send\", handleButtonClick: function () { return _this.sendTextMessage(); }, disabled: this.chatState === ChatState.Error || this.chatState !== ChatState.Initial }));\n        return [textInput, micButton, sendButton];\n    };\n    class_1.prototype.errorToast = function () {\n        var _this = this;\n        if (!this.error)\n            return;\n        var _a = this.error, message = _a.message, errorType = _a.errorType;\n        return Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"amplify-toast\", { message: _aws_amplify_core__WEBPACK_IMPORTED_MODULE_1__[\"I18n\"].get(message), handleClose: function () { return _this.handleToastClose(errorType); } });\n    };\n    class_1.prototype.render = function () {\n        return (Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"H\"], null, Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"div\", { class: \"amplify-chatbot\" }, Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"slot\", { name: \"header\" }, Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"div\", { class: \"header\", \"data-test\": \"chatbot-header\" }, _aws_amplify_core__WEBPACK_IMPORTED_MODULE_1__[\"I18n\"].get(this.botTitle))), Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"div\", { class: \"body\", \"data-test\": \"chatbot-body\" }, this.messageJSX(this.messages)), Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"h\"])(\"div\", { class: \"footer\", \"data-test\": \"chatbot-footer\" }, this.footerJSX()), this.errorToast())));\n    };\n    Object.defineProperty(class_1.prototype, \"element\", {\n        get: function () { return Object(_index_39969785_js__WEBPACK_IMPORTED_MODULE_0__[\"g\"])(this); },\n        enumerable: false,\n        configurable: true\n    });\n    return class_1;\n}());\nAmplifyChatbot.style = amplifyChatbotCss;\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4vbm9kZV9tb2R1bGVzL0Bhd3MtYW1wbGlmeS91aS1jb21wb25lbnRzL2Rpc3QvZXNtLWVzNS9hbXBsaWZ5LWNoYXRib3QuZW50cnkuanM/OWIyYyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsaUJBQWlCLFNBQUksSUFBSSxTQUFJO0FBQzdCLDJCQUEyQiwrREFBK0QsZ0JBQWdCLEVBQUUsRUFBRTtBQUM5RztBQUNBLG1DQUFtQyxNQUFNLDZCQUE2QixFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ2pHLGtDQUFrQyxNQUFNLGlDQUFpQyxFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ3BHLCtCQUErQixxRkFBcUY7QUFDcEg7QUFDQSxLQUFLO0FBQ0w7QUFDQSxtQkFBbUIsU0FBSSxJQUFJLFNBQUk7QUFDL0IsYUFBYSw2QkFBNkIsMEJBQTBCLGFBQWEsRUFBRSxxQkFBcUI7QUFDeEcsZ0JBQWdCLHFEQUFxRCxvRUFBb0UsYUFBYSxFQUFFO0FBQ3hKLHNCQUFzQixzQkFBc0IscUJBQXFCLEdBQUc7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDO0FBQ3ZDLGtDQUFrQyxTQUFTO0FBQzNDLGtDQUFrQyxXQUFXLFVBQVU7QUFDdkQseUNBQXlDLGNBQWM7QUFDdkQ7QUFDQSw2R0FBNkcsT0FBTyxVQUFVO0FBQzlILGdGQUFnRixpQkFBaUIsT0FBTztBQUN4Ryx3REFBd0QsZ0JBQWdCLFFBQVEsT0FBTztBQUN2Riw4Q0FBOEMsZ0JBQWdCLGdCQUFnQixPQUFPO0FBQ3JGO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQSxTQUFTLFlBQVksYUFBYSxPQUFPLEVBQUUsVUFBVSxXQUFXO0FBQ2hFLG1DQUFtQyxTQUFTO0FBQzVDO0FBQ0E7QUFDQSxzQkFBc0IsU0FBSSxJQUFJLFNBQUk7QUFDbEMsaURBQWlELFFBQVE7QUFDekQsd0NBQXdD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b0NBQW9DLEVBQUUsdUZBQXVGO0FBQzVRLDhDQUE4Qyw0REFBQyxvQkFBb0Isb0VBQW9FLGdDQUFnQyxFQUFFLG1KQUFtSjtBQUM1VCw4Q0FBOEMsNERBQUMsb0JBQW9CLDBIQUEwSCxnQ0FBZ0MsRUFBRSx3RkFBd0Y7QUFDdlQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLDREQUFDLG1CQUFtQixVQUFVLHNEQUFJLHlDQUF5QywwQ0FBMEMsRUFBRSxFQUFFO0FBQ3hJO0FBQ0E7QUFDQSxnQkFBZ0IsNERBQUMsQ0FBQyxvREFBSSxRQUFRLDREQUFDLFNBQVMsMkJBQTJCLEVBQUUsNERBQUMsVUFBVSxpQkFBaUIsRUFBRSw0REFBQyxTQUFTLGlEQUFpRCxFQUFFLHNEQUFJLHVCQUF1Qiw0REFBQyxTQUFTLDZDQUE2QyxtQ0FBbUMsNERBQUMsU0FBUyxpREFBaUQ7QUFDaFY7QUFDQTtBQUNBLDBCQUEwQixRQUFRLDREQUFVLE9BQU8sRUFBRTtBQUNyRDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsQ0FBQztBQUNEO0FBQzZDIiwiZmlsZSI6Ii4vbm9kZV9tb2R1bGVzL0Bhd3MtYW1wbGlmeS91aS1jb21wb25lbnRzL2Rpc3QvZXNtLWVzNS9hbXBsaWZ5LWNoYXRib3QuZW50cnkuanMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7XG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcbiAgICB9XG59O1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGgsIGMgYXMgY3JlYXRlRXZlbnQsIEggYXMgSG9zdCwgZyBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC0zOTk2OTc4NS5qcyc7XG5pbXBvcnQgeyBMb2dnZXIsIGJyb3dzZXJPck5vZGUsIEkxOG4gfSBmcm9tICdAYXdzLWFtcGxpZnkvY29yZSc7XG5pbXBvcnQgJ0Bhd3MtYW1wbGlmeS9hdXRoJztcbmltcG9ydCB7IFQgYXMgVHJhbnNsYXRpb25zIH0gZnJvbSAnLi9UcmFuc2xhdGlvbnMtMzkyYWNiOWIuanMnO1xuaW1wb3J0IHsgZCBhcyBOT19JTlRFUkFDVElPTlNfTU9EVUxFX0ZPVU5EIH0gZnJvbSAnLi9jb25zdGFudHMtZDFhYmU3ZGUuanMnO1xuaW1wb3J0IHsgSW50ZXJhY3Rpb25zIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L2ludGVyYWN0aW9ucyc7XG4vLyBBdWRpb1JlY29yZGVyIHNldHRpbmdzXG52YXIgUkVDT1JERVJfRVhQT1JUX01JTUVfVFlQRSA9ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nO1xudmFyIERFRkFVTFRfRVhQT1JUX1NBTVBMRV9SQVRFID0gMTYwMDA7XG52YXIgRkZUX1NJWkUgPSAyMDQ4OyAvLyB3aW5kb3cgc2l6ZSBpbiBzYW1wbGVzIGZvciBGYXN0IEZvdXJpZXIgVHJhbnNmb3JtIChGRlQpXG52YXIgRkZUX01BWF9ERUNJQkVMUyA9IC0xMDsgLy8gbWF4aW11bSBwb3dlciB2YWx1ZSBpbiB0aGUgc2NhbGluZyByYW5nZSBmb3IgdGhlIEZGVCBhbmFseXNpcyBkYXRhXG52YXIgRkZUX01JTl9ERUNJQkVMUyA9IC05MDsgLy8gbWluaW11bSBwb3dlciB2YWx1ZSBpbiB0aGUgc2NhbGluZyByYW5nZSBmb3IgdGhlIEZGVCBhbmFseXNpcyBkYXRhXG52YXIgRkZUX1NNT09USElOR19USU1FX0NPTlNUQU5UID0gMC44NTsgLy8gYXZlcmFnaW5nIGNvbnN0YW50IHdpdGggdGhlIGxhc3QgYW5hbHlzaXMgZnJhbWVcbi8qKlxuICogTWVyZ2VzIG11bHRpcGxlIGJ1ZmZlcnMgaW50byBvbmUuXG4gKi9cbnZhciBtZXJnZUJ1ZmZlcnMgPSBmdW5jdGlvbiAoYnVmZmVyQXJyYXksIHJlY0xlbmd0aCkge1xuICAgIHZhciByZXN1bHQgPSBuZXcgRmxvYXQzMkFycmF5KHJlY0xlbmd0aCk7XG4gICAgdmFyIG9mZnNldCA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBidWZmZXJBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICByZXN1bHQuc2V0KGJ1ZmZlckFycmF5W2ldLCBvZmZzZXQpO1xuICAgICAgICBvZmZzZXQgKz0gYnVmZmVyQXJyYXlbaV0ubGVuZ3RoO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbi8qKlxuICogRG93bnNhbXBsZXMgYXVkaW8gdG8gZGVzaXJlZCBleHBvcnQgc2FtcGxlIHJhdGUuXG4gKi9cbnZhciBkb3duc2FtcGxlQnVmZmVyID0gZnVuY3Rpb24gKGJ1ZmZlciwgcmVjb3JkU2FtcGxlUmF0ZSwgZXhwb3J0U2FtcGxlUmF0ZSkge1xuICAgIGlmIChleHBvcnRTYW1wbGVSYXRlID09PSByZWNvcmRTYW1wbGVSYXRlKSB7XG4gICAgICAgIHJldHVybiBidWZmZXI7XG4gICAgfVxuICAgIHZhciBzYW1wbGVSYXRlUmF0aW8gPSByZWNvcmRTYW1wbGVSYXRlIC8gZXhwb3J0U2FtcGxlUmF0ZTtcbiAgICB2YXIgbmV3TGVuZ3RoID0gTWF0aC5yb3VuZChidWZmZXIubGVuZ3RoIC8gc2FtcGxlUmF0ZVJhdGlvKTtcbiAgICB2YXIgcmVzdWx0ID0gbmV3IEZsb2F0MzJBcnJheShuZXdMZW5ndGgpO1xuICAgIHZhciBvZmZzZXRSZXN1bHQgPSAwO1xuICAgIHZhciBvZmZzZXRCdWZmZXIgPSAwO1xuICAgIHdoaWxlIChvZmZzZXRSZXN1bHQgPCByZXN1bHQubGVuZ3RoKSB7XG4gICAgICAgIHZhciBuZXh0T2Zmc2V0QnVmZmVyID0gTWF0aC5yb3VuZCgob2Zmc2V0UmVzdWx0ICsgMSkgKiBzYW1wbGVSYXRlUmF0aW8pO1xuICAgICAgICB2YXIgYWNjdW0gPSAwLCBjb3VudCA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSBvZmZzZXRCdWZmZXI7IGkgPCBuZXh0T2Zmc2V0QnVmZmVyICYmIGkgPCBidWZmZXIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGFjY3VtICs9IGJ1ZmZlcltpXTtcbiAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0W29mZnNldFJlc3VsdF0gPSBhY2N1bSAvIGNvdW50O1xuICAgICAgICBvZmZzZXRSZXN1bHQrKztcbiAgICAgICAgb2Zmc2V0QnVmZmVyID0gbmV4dE9mZnNldEJ1ZmZlcjtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG4vKipcbiAqIGNvbnZlcnRzIHJhdyBhdWRpbyB2YWx1ZXMgdG8gMTYgYml0IHBjbS5cbiAqL1xudmFyIGZsb2F0VG8xNkJpdFBDTSA9IGZ1bmN0aW9uIChvdXRwdXQsIG9mZnNldCwgaW5wdXQpIHtcbiAgICB2YXIgYnl0ZU9mZnNldCA9IG9mZnNldDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsgaSsrLCBieXRlT2Zmc2V0ICs9IDIpIHtcbiAgICAgICAgdmFyIHMgPSBNYXRoLm1heCgtMSwgTWF0aC5taW4oMSwgaW5wdXRbaV0pKTtcbiAgICAgICAgb3V0cHV0LnNldEludDE2KGJ5dGVPZmZzZXQsIHMgPCAwID8gcyAqIDB4ODAwMCA6IHMgKiAweDdmZmYsIHRydWUpO1xuICAgIH1cbn07XG4vKipcbiAqIFdyaXRlIGdpdmVuIHN0cmluZ3MgaW4gYmlnLWVuZGlhbiBvcmRlci5cbiAqL1xudmFyIHdyaXRlU3RyaW5nID0gZnVuY3Rpb24gKHZpZXcsIG9mZnNldCwgc3RyaW5nKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHJpbmcubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmlldy5zZXRVaW50OChvZmZzZXQgKyBpLCBzdHJpbmcuY2hhckNvZGVBdChpKSk7XG4gICAgfVxufTtcbi8qKlxuICogRW5jb2RlcyByYXcgcGNtIGF1ZGlvIGludG8gYSB3YXYgZmlsZS5cbiAqL1xudmFyIGVuY29kZVdBViA9IGZ1bmN0aW9uIChzYW1wbGVzLCBleHBvcnRTYW1wbGVSYXRlKSB7XG4gICAgLyoqXG4gICAgICogV0FWIGZpbGUgY29uc2lzdHMgb2YgdGhyZWUgcGFydHM6IFJJRkYgaGVhZGVyLCBXQVZFIHN1YmNodW5rLCBhbmQgZGF0YSBzdWJjaHVuay4gV2UgcHJlY29tcHV0ZSB0aGUgc2l6ZSBvZiB0aGVtLlxuICAgICAqL1xuICAgIHZhciBhdWRpb1NpemUgPSBzYW1wbGVzLmxlbmd0aCAqIDI7IC8vIFdlIHVzZSAxNi1iaXQgc2FtcGxlcywgc28gd2UgaGF2ZSAoMiAqIHNhbXBsZUxlbmd0aCkgYnl0ZXMuXG4gICAgdmFyIGZtdFNpemUgPSAyNDsgLy8gQnl0ZSBzaXplIG9mIHRoZSBmbXQgc3ViY2h1bms6IDI0IGJ5dGVzIHRoYXQgdGhlIGF1ZGlvIGluZm9ybWF0aW9uIHRoYXQgd2UnbGwgc2V0IGJlbG93LlxuICAgIHZhciBkYXRhU2l6ZSA9IDggKyBhdWRpb1NpemU7IC8vIEJ5dGUgc2l6ZSBvZiB0aGUgZGF0YSBzdWJjaHVuazogcmF3IHNvdW5kIGRhdGEgcGx1cyA4IGJ5dGVzIGZvciB0aGUgc3ViY2h1bmsgZGVzY3JpcHRpb25zLlxuICAgIHZhciB0b3RhbEJ5dGVTaXplID0gMTIgKyBmbXRTaXplICsgZGF0YVNpemU7IC8vIEJ5dGUgc2l6ZSBvZiB0aGUgd2hvbGUgZmlsZSwgaW5jbHVkaW5nIHRoZSBjaHVuayBoZWFkZXIgLyBkZXNjcmlwdG9yLlxuICAgIC8vIGNyZWF0ZSBEYXRhVmlldyBvYmplY3QgdG8gd3JpdGUgYnl0ZSB2YWx1ZXMgaW50b1xuICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIodG90YWxCeXRlU2l6ZSk7IC8vIGJ1ZmZlciB0byB3cml0ZSB0aGUgY2h1bmsgdmFsdWVzIGluLlxuICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7XG4gICAgLyoqXG4gICAgICogU3RhcnQgd3JpdGluZyB0aGUgLndhdiBmaWxlLiBXZSB3cml0ZSB0b3AgdG8gYm90dG9tLCBzbyBieXRlIG9mZnNldCAoZmlyc3QgbnVtZXJpYyBhcmd1bWVudCkgaW5jcmVhc2VzIHN0cmljdGx5LlxuICAgICAqL1xuICAgIC8vIFJJRkYgaGVhZGVyXG4gICAgd3JpdGVTdHJpbmcodmlldywgMCwgJ1JJRkYnKTsgLy8gQXQgb2Zmc2V0IDAsIHdyaXRlIHRoZSBsZXR0ZXJzIFwiUklGRlwiXG4gICAgdmlldy5zZXRVaW50MzIoNCwgZm10U2l6ZSArIGRhdGFTaXplLCB0cnVlKTsgLy8gQXQgb2Zmc2V0IDQsIHdyaXRlIHRoZSBzaXplIG9mIGZtdCBhbmQgZGF0YSBjaHVuayBzaXplIGNvbWJpbmVkLlxuICAgIHdyaXRlU3RyaW5nKHZpZXcsIDgsICdXQVZFJyk7IC8vIEF0IG9mZnNldCA4LCB3cml0ZSB0aGUgZm9ybWF0IHR5cGUgXCJXQVZFXCJcbiAgICAvLyBmbXQgc3ViY2h1bmtcbiAgICB3cml0ZVN0cmluZyh2aWV3LCAxMiwgJ2ZtdCAnKTsgLy9jaHVua2RJZCAnZm10ICdcbiAgICB2aWV3LnNldFVpbnQzMigxNiwgZm10U2l6ZSAtIDgsIHRydWUpOyAvLyBmbXQgc3ViY2h1bmsgc2l6ZSBiZWxvdyB0aGlzIHZhbHVlLiBXZSBzZXQgOCBieXRlcyBhbHJlYWR5LCBzbyBzdWJ0cmFjdCA4IGJ5dGVzIGZyb20gZm10U2l6ZS5cbiAgICB2aWV3LnNldFVpbnQxNigyMCwgMSwgdHJ1ZSk7IC8vIEF1ZGlpbyBmb3JtYXQgY29kZSwgd2hpY2ggaXMgMSBmb3IgUENNLlxuICAgIHZpZXcuc2V0VWludDE2KDIyLCAxLCB0cnVlKTsgLy8gTnVtYmVyIG9mIGF1ZGlvIGNoYW5uZWxzLiBXZSB1c2UgbW9ubywgaWUgMS5cbiAgICB2aWV3LnNldFVpbnQzMigyNCwgZXhwb3J0U2FtcGxlUmF0ZSwgdHJ1ZSk7IC8vIFNhbXBsZSByYXRlIG9mIHRoZSBhdWRpbyBmaWxlLlxuICAgIHZpZXcuc2V0VWludDMyKDI4LCBleHBvcnRTYW1wbGVSYXRlICogMiwgdHJ1ZSk7IC8vIERhdGEgcmF0ZSwgb3IgIyBvZiBkYXRhIGJ5dGVzIHBlciBzZWNvbmQuIFNpbmNlIGVhY2ggc2FtcGxlIGlzIDIgYnl0ZXMsIHRoaXMgaXMgMiAqIHNhbXBsZVJhdGUuXG4gICAgdmlldy5zZXRVaW50MTYoMzIsIDIsIHRydWUpOyAvLyBibG9jayBhbGlnbiwgIyBvZiBieXRlcyBwZXIgc2FtcGxlIGluY2x1ZGluZyBhbGwgY2hhbm5lbHMsIGllLiAyIGJ5dGVzLlxuICAgIHZpZXcuc2V0VWludDE2KDM0LCAxNiwgdHJ1ZSk7IC8vIGJpdHMgcGVyIHNhbXBsZSwgaWUuIDE2IGJpdHNcbiAgICAvLyBkYXRhIHN1YmNodW5rXG4gICAgd3JpdGVTdHJpbmcodmlldywgMzYsICdkYXRhJyk7IC8vIHdyaXRlIHRoZSBjaHVua0lkICdkYXRhJ1xuICAgIHZpZXcuc2V0VWludDMyKDQwLCBhdWRpb1NpemUsIHRydWUpOyAvLyBBdWRpbyBieXRlIHNpemVcbiAgICBmbG9hdFRvMTZCaXRQQ00odmlldywgNDQsIHNhbXBsZXMpOyAvLyByYXcgcGNtIHZhbHVlcyB0aGVuIGdvIGhlcmUuXG4gICAgcmV0dXJuIHZpZXc7XG59O1xuLyoqXG4gKiBHaXZlbiBhcnJheXMgb2YgcmF3IHBjbSBhdWRpbywgZG93bnNhbXBsZXMgdGhlIGF1ZGlvIHRvIGRlc2lyZWQgc2FtcGxlIHJhdGUgYW5kIGVuY29kZXMgaXQgdG8gYSB3YXYgYXVkaW8gZmlsZS5cbiAqXG4gKiBAcGFyYW0gcmVjQnVmZmVyIHtGbG9hdDMyQXJyYXlbXX0gLSAyZCBmbG9hdCBhcnJheSBjb250YWluaW5nIHRoZSByZWNvcmRlZCByYXcgYXVkaW9cbiAqIEBwYXJhbSByZWNMZW5ndGgge251bWJlcn0gLSB0b3RhbCBsZW5ndGggb2YgcmVjb3JkZWQgYXVkaW9cbiAqIEBwYXJhbSByZWNvcmRTYW1wbGVSYXRlIHtudW1iZXJ9IC0gc2FtcGxlIHJhdGUgb2YgdGhlIHJlY29yZGVkIGF1ZGlvXG4gKiBAcGFyYW0gZXhwb3J0U2FtcGxlUmF0ZSB7bnVtYmVyfSAtIGRlc2lyZWQgc2FtcGxlIHJhdGUgb2YgdGhlIGV4cG9ydGVkIGZpbGVcbiAqL1xudmFyIGV4cG9ydEJ1ZmZlciA9IGZ1bmN0aW9uIChyZWNCdWZmZXIsIHJlY0xlbmd0aCwgcmVjb3JkU2FtcGxlUmF0ZSwgZXhwb3J0U2FtcGxlUmF0ZSkge1xuICAgIHZhciBtZXJnZWRCdWZmZXJzID0gbWVyZ2VCdWZmZXJzKHJlY0J1ZmZlciwgcmVjTGVuZ3RoKTtcbiAgICB2YXIgZG93bnNhbXBsZWRCdWZmZXIgPSBkb3duc2FtcGxlQnVmZmVyKG1lcmdlZEJ1ZmZlcnMsIHJlY29yZFNhbXBsZVJhdGUsIGV4cG9ydFNhbXBsZVJhdGUpO1xuICAgIHZhciBlbmNvZGVkV2F2ID0gZW5jb2RlV0FWKGRvd25zYW1wbGVkQnVmZmVyLCBleHBvcnRTYW1wbGVSYXRlKTtcbiAgICB2YXIgYXVkaW9CbG9iID0gbmV3IEJsb2IoW2VuY29kZWRXYXZdLCB7XG4gICAgICAgIHR5cGU6IFJFQ09SREVSX0VYUE9SVF9NSU1FX1RZUEUsXG4gICAgfSk7XG4gICAgcmV0dXJuIGF1ZGlvQmxvYjtcbn07XG52YXIgbG9nZ2VyID0gbmV3IExvZ2dlcignQXVkaW9SZWNvcmRlcicpO1xudmFyIEF1ZGlvUmVjb3JkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQXVkaW9SZWNvcmRlcihvcHRpb25zKSB7XG4gICAgICAgIC8vIGlucHV0IG1pYyBzdHJlYW0gaXMgc3RvcmVkIGluIGEgYnVmZmVyXG4gICAgICAgIHRoaXMuc3RyZWFtQnVmZmVyID0gW107XG4gICAgICAgIHRoaXMuc3RyZWFtQnVmZmVyTGVuZ3RoID0gMDtcbiAgICAgICAgdGhpcy5yZWNvcmRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhpcyBtdXN0IGJlIGNhbGxlZCBmaXJzdCB0byBlbmFibGUgYXVkaW8gY29udGV4dCBhbmQgcmVxdWVzdCBtaWNyb3Bob25lIGFjY2Vzcy5cbiAgICAgKiBPbmNlIGFjY2VzcyBncmFudGVkLCBpdCBjb25uZWN0cyBhbGwgdGhlIG5lY2Vzc2FyeSBhdWRpbyBub2RlcyB0byB0aGUgY29udGV4dCBzbyB0aGF0IGl0IGNhbiBiZWdpbiByZWNvcmRpbmcgb3IgcGxheWluZy5cbiAgICAgKi9cbiAgICBBdWRpb1JlY29yZGVyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFicm93c2VyT3JOb2RlKCkuaXNCcm93c2VyKSByZXR1cm4gWzMgLypicmVhayovLCAyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5BdWRpb0NvbnRleHQgPSB3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvQ29udGV4dCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIG5hdmlnYXRvci5tZWRpYURldmljZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldFVzZXJNZWRpYSh7IGF1ZGlvOiB0cnVlIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChzdHJlYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXVkaW9TdXBwb3J0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXR1cEF1ZGlvTm9kZXMoc3RyZWFtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdWRpb1N1cHBvcnRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ0F1ZGlvIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDNdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvU3VwcG9ydGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgUHJvbWlzZS5yZWplY3QoJ0F1ZGlvIGlzIG5vdCBzdXBwb3J0ZWQnKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzogcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFNldHVwIGF1ZGlvIG5vZGVzIGFmdGVyIHN1Y2Nlc3NmdWwgYGluaXRgLlxuICAgICAqL1xuICAgIEF1ZGlvUmVjb3JkZXIucHJvdG90eXBlLnNldHVwQXVkaW9Ob2RlcyA9IGZ1bmN0aW9uIChzdHJlYW0pIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGVycl8xLCBzb3VyY2VOb2RlLCBwcm9jZXNzb3JOb2RlLCBhbmFseXNlck5vZGU7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFswLCAyLCAsIDNdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuYXVkaW9Db250ZXh0LnJlc3VtZSgpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgM107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycl8xID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycl8xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDNdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VOb2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2Uoc3RyZWFtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3Nvck5vZGUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVTY3JpcHRQcm9jZXNzb3IoNDA5NiwgMSwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzb3JOb2RlLm9uYXVkaW9wcm9jZXNzID0gZnVuY3Rpb24gKGF1ZGlvUHJvY2Vzc2luZ0V2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5yZWNvcmRpbmcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyZWFtID0gYXVkaW9Qcm9jZXNzaW5nRXZlbnQuaW5wdXRCdWZmZXIuZ2V0Q2hhbm5lbERhdGEoMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3RyZWFtQnVmZmVyLnB1c2gobmV3IEZsb2F0MzJBcnJheShzdHJlYW0pKTsgLy8gc2V0IHRvIGEgY29weSBvZiB0aGUgc3RyZWFtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3RyZWFtQnVmZmVyTGVuZ3RoICs9IHN0cmVhbS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYW5hbHlzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuYWx5c2VyTm9kZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUFuYWx5c2VyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbmFseXNlck5vZGUubWluRGVjaWJlbHMgPSBGRlRfTUlOX0RFQ0lCRUxTO1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5hbHlzZXJOb2RlLm1heERlY2liZWxzID0gRkZUX01BWF9ERUNJQkVMUztcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuYWx5c2VyTm9kZS5zbW9vdGhpbmdUaW1lQ29uc3RhbnQgPSBGRlRfU01PT1RISU5HX1RJTUVfQ09OU1RBTlQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VOb2RlLmNvbm5lY3QoYW5hbHlzZXJOb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuYWx5c2VyTm9kZS5jb25uZWN0KHByb2Nlc3Nvck5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc29yTm9kZS5jb25uZWN0KHNvdXJjZU5vZGUuY29udGV4dC5kZXN0aW5hdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFuYWx5c2VyTm9kZSA9IGFuYWx5c2VyTm9kZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBTdGFydCByZWNvcmRpbmcgYXVkaW8gYW5kIGxpc3RlbiBmb3Igc2lsZW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvblNpbGVuY2Uge1NpbGVuY2VIYW5kbGVyfSAtIGNhbGxlZCB3aGVuZXZlciBzaWxlbmNlIGlzIGRldGVjdGVkXG4gICAgICogQHBhcmFtIHZpc3VhbGl6ZXIge1Zpc3VhbGl6ZXJ9IC0gY2FsbGVkIHdpdGggYXVkaW8gZGF0YSBvbiBlYWNoIGF1ZGlvIHByb2Nlc3MgdG8gYmUgdXNlZCBmb3IgdmlzdWFsaXphdGlvbi5cbiAgICAgKi9cbiAgICBBdWRpb1JlY29yZGVyLnByb3RvdHlwZS5zdGFydFJlY29yZGluZyA9IGZ1bmN0aW9uIChvblNpbGVuY2UsIHZpc3VhbGl6ZXIpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNvbnRleHQsIGVycl8yO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVjb3JkaW5nIHx8ICF0aGlzLmF1ZGlvU3VwcG9ydGVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25TaWxlbmNlID0gb25TaWxlbmNlIHx8IGZ1bmN0aW9uICgpIHsgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlzdWFsaXplciA9IHZpc3VhbGl6ZXIgfHwgZnVuY3Rpb24gKCkgeyB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IHRoaXMuYXVkaW9Db250ZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAxO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzEsIDMsICwgNF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgY29udGV4dC5yZXN1bWUoKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJfMiA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJfMik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydCA9IERhdGUubm93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY29yZGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUGF1c2UgcmVjb3JkaW5nXG4gICAgICovXG4gICAgQXVkaW9SZWNvcmRlci5wcm90b3R5cGUuc3RvcFJlY29yZGluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmF1ZGlvU3VwcG9ydGVkKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLnJlY29yZGluZyA9IGZhbHNlO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUGF1c2UgcmVjb3JkaW5nIGFuZCBjbGVhciBhdWRpbyBidWZmZXJcbiAgICAgKi9cbiAgICBBdWRpb1JlY29yZGVyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdG9wUmVjb3JkaW5nKCk7XG4gICAgICAgIHRoaXMuc3RyZWFtQnVmZmVyTGVuZ3RoID0gMDtcbiAgICAgICAgdGhpcy5zdHJlYW1CdWZmZXIgPSBbXTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFBsYXlzIGdpdmVuIGF1ZGlvU3RyZWFtIHdpdGggYXVkaW9Db250ZXh0XG4gICAgICpcbiAgICAgKiBAcGFyYW0gYnVmZmVyIHtVaW50OEFycmF5fSAtIGF1ZGlvU3RyZWFtIHRvIGJlIHBsYXllZFxuICAgICAqL1xuICAgIEF1ZGlvUmVjb3JkZXIucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbiAoYnVmZmVyKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICghYnVmZmVyIHx8ICF0aGlzLmF1ZGlvU3VwcG9ydGVkKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB2YXIgbXlCbG9iID0gbmV3IEJsb2IoW2J1ZmZlcl0pO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlcywgcmVqKSB7XG4gICAgICAgICAgICB2YXIgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgICAgICBmaWxlUmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMucGxheWJhY2tTb3VyY2UpXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnBsYXliYWNrU291cmNlLmRpc2Nvbm5lY3QoKTsgLy8gZGlzY29ubmVjdCBwcmV2aW91cyBwbGF5YmFjayBzb3VyY2VcbiAgICAgICAgICAgICAgICBfdGhpcy5wbGF5YmFja1NvdXJjZSA9IF90aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc0NhbGxiYWNrID0gZnVuY3Rpb24gKGJ1Zikge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5wbGF5YmFja1NvdXJjZS5idWZmZXIgPSBidWY7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnBsYXliYWNrU291cmNlLmNvbm5lY3QoX3RoaXMuYXVkaW9Db250ZXh0LmRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucGxheWJhY2tTb3VyY2Uub25lbmRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucGxheWJhY2tTb3VyY2Uuc3RhcnQoMCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JDYWxsYmFjayA9IGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlaihlcnIpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgX3RoaXMuYXVkaW9Db250ZXh0LmRlY29kZUF1ZGlvRGF0YShmaWxlUmVhZGVyLnJlc3VsdCwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBmaWxlUmVhZGVyLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7IHJldHVybiByZWooKTsgfTtcbiAgICAgICAgICAgIGZpbGVSZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIobXlCbG9iKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBTdG9wcyBwbGF5aW5nIGF1ZGlvIGlmIHRoZXJlJ3MgYSBwbGF5YmFjayBzb3VyY2UgY29ubmVjdGVkLlxuICAgICAqL1xuICAgIEF1ZGlvUmVjb3JkZXIucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnBsYXliYWNrU291cmNlKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXliYWNrU291cmNlLnN0b3AoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogQ2FsbGVkIGFmdGVyIGVhY2ggYXVkaW9Qcm9jZXNzLiBDaGVjayBmb3Igc2lsZW5jZSBhbmQgZ2l2ZSBmZnQgdGltZSBkb21haW4gZGF0YSB0byB2aXN1YWxpemVyLlxuICAgICAqL1xuICAgIEF1ZGlvUmVjb3JkZXIucHJvdG90eXBlLmFuYWx5c2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5hdWRpb1N1cHBvcnRlZClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdmFyIGFuYWx5c2VyID0gdGhpcy5hbmFseXNlck5vZGU7XG4gICAgICAgIGFuYWx5c2VyLmZmdFNpemUgPSBGRlRfU0laRTtcbiAgICAgICAgdmFyIGJ1ZmZlckxlbmd0aCA9IGFuYWx5c2VyLmZmdFNpemU7XG4gICAgICAgIHZhciBkYXRhQXJyYXkgPSBuZXcgVWludDhBcnJheShidWZmZXJMZW5ndGgpO1xuICAgICAgICB2YXIgYW1wbGl0dWRlID0gdGhpcy5vcHRpb25zLmFtcGxpdHVkZTtcbiAgICAgICAgdmFyIHRpbWUgPSB0aGlzLm9wdGlvbnMudGltZTtcbiAgICAgICAgYW5hbHlzZXIuZ2V0Qnl0ZVRpbWVEb21haW5EYXRhKGRhdGFBcnJheSk7XG4gICAgICAgIHRoaXMudmlzdWFsaXplcihkYXRhQXJyYXksIGJ1ZmZlckxlbmd0aCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnVmZmVyTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIC8vIE5vcm1hbGl6ZSBiZXR3ZWVuIC0xIGFuZCAxLlxuICAgICAgICAgICAgdmFyIGN1cnJfdmFsdWVfdGltZSA9IGRhdGFBcnJheVtpXSAvIDEyOCAtIDEuMDtcbiAgICAgICAgICAgIGlmIChjdXJyX3ZhbHVlX3RpbWUgPiBhbXBsaXR1ZGUgfHwgY3Vycl92YWx1ZV90aW1lIDwgLTEgKiBhbXBsaXR1ZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgbmV3dGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIHZhciBlbGFwc2VkVGltZSA9IG5ld3RpbWUgLSB0aGlzLnN0YXJ0O1xuICAgICAgICBpZiAoZWxhcHNlZFRpbWUgPiB0aW1lKSB7XG4gICAgICAgICAgICB0aGlzLm9uU2lsZW5jZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBFbmNvZGVzIHJlY29yZGVkIGJ1ZmZlciB0byBhIHdhdiBmaWxlIGFuZCBleHBvcnRzIGl0IHRvIGEgYmxvYi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBleHBvcnRTYW1wbGVSYXRlIHtudW1iZXJ9IC0gZGVzaXJlZCBzYW1wbGUgcmF0ZSBvZiB0aGUgZXhwb3J0ZWQgYnVmZmVyXG4gICAgICovXG4gICAgQXVkaW9SZWNvcmRlci5wcm90b3R5cGUuZXhwb3J0V0FWID0gZnVuY3Rpb24gKGV4cG9ydFNhbXBsZVJhdGUpIHtcbiAgICAgICAgaWYgKGV4cG9ydFNhbXBsZVJhdGUgPT09IHZvaWQgMCkgeyBleHBvcnRTYW1wbGVSYXRlID0gREVGQVVMVF9FWFBPUlRfU0FNUExFX1JBVEU7IH1cbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHJlY29yZFNhbXBsZVJhdGUsIGJsb2I7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmF1ZGlvU3VwcG9ydGVkKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgcmVjb3JkU2FtcGxlUmF0ZSA9IHRoaXMuYXVkaW9Db250ZXh0LnNhbXBsZVJhdGU7XG4gICAgICAgICAgICAgICAgYmxvYiA9IGV4cG9ydEJ1ZmZlcih0aGlzLnN0cmVhbUJ1ZmZlciwgdGhpcy5zdHJlYW1CdWZmZXJMZW5ndGgsIHJlY29yZFNhbXBsZVJhdGUsIGV4cG9ydFNhbXBsZVJhdGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgYmxvYl07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gQXVkaW9SZWNvcmRlcjtcbn0oKSk7XG52YXIgdmlzdWFsaXplID0gZnVuY3Rpb24gKGRhdGFBcnJheSwgYnVmZmVyTGVuZ3RoLCBjYW52YXMpIHtcbiAgICBpZiAoIWNhbnZhcylcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmICghYnJvd3Nlck9yTm9kZSgpLmlzQnJvd3NlcilcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdWaXN1YWxpemF0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgb24gbm9uLWJyb3dzZXJzLicpO1xuICAgIHZhciBfYSA9IGNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgd2lkdGggPSBfYS53aWR0aCwgaGVpZ2h0ID0gX2EuaGVpZ2h0O1xuICAgIC8vIG5lZWQgdG8gdXBkYXRlIHRoZSBkZWZhdWx0IGNhbnZhcyB3aWR0aCBhbmQgaGVpZ2h0XG4gICAgY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcbiAgICB2YXIgY2FudmFzQ3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY2FudmFzQ3R4LmZpbGxTdHlsZSA9ICd3aGl0ZSc7XG4gICAgY2FudmFzQ3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB2YXIgZHJhdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2FudmFzQ3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICBjYW52YXNDdHgubGluZVdpZHRoID0gMTtcbiAgICAgICAgdmFyIGNvbG9yID0gZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmdldFByb3BlcnR5VmFsdWUoJy0tYW1wbGlmeS1wcmltYXJ5LWNvbG9yJyk7XG4gICAgICAgIGNhbnZhc0N0eC5zdHJva2VTdHlsZSA9ICFjb2xvciB8fCBjb2xvciA9PT0gJycgPyAnI2ZmOTkwMCcgOiBjb2xvcjsgLy8gVE9ETzogdHJ5IHNlcGFyYXRlIGNzcyB2YXJpYWJsZVxuICAgICAgICBjYW52YXNDdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIHZhciBzbGljZVdpZHRoID0gKHdpZHRoICogMS4wKSAvIGJ1ZmZlckxlbmd0aDtcbiAgICAgICAgdmFyIHggPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJ1ZmZlckxlbmd0aCB8fCBpICUgMyA9PT0gMDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBkYXRhQXJyYXlbaV0gLyAxMjguMDtcbiAgICAgICAgICAgIHZhciB5ID0gKHZhbHVlICogaGVpZ2h0KSAvIDI7XG4gICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNhbnZhc0N0eC5tb3ZlVG8oeCwgeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYW52YXNDdHgubGluZVRvKHgsIHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgeCArPSBzbGljZVdpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGNhbnZhc0N0eC5saW5lVG8oY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0IC8gMik7XG4gICAgICAgIGNhbnZhc0N0eC5zdHJva2UoKTtcbiAgICB9O1xuICAgIC8vIFJlZ2lzdGVyIG91ciBkcmF3IGZ1bmN0aW9uIHdpdGggcmVxdWVzdEFuaW1hdGlvbkZyYW1lLlxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShkcmF3KTtcbn07XG52YXIgYW1wbGlmeUNoYXRib3RDc3MgPSBcIi5ib3QgLmRvdHtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWJvdC1kb3QtY29sb3IpfS51c2VyIC5kb3R7YmFja2dyb3VuZC1jb2xvcjp2YXIoLS11c2VyLWRvdC1jb2xvcil9LmRvdC1mbGFzaGluZ3t3aWR0aDoyLjYyNXJlbX0uZG90LWZsYXNoaW5nIC5kb3R7ZGlzcGxheTppbmxpbmUtYmxvY2s7d2lkdGg6MC42MjVyZW07aGVpZ2h0OjAuNjI1cmVtO2JvcmRlci1yYWRpdXM6MTByZW07b3BhY2l0eTowLjY1fS5kb3QtZmxhc2hpbmcgLmxlZnR7LXdlYmtpdC1hbmltYXRpb246ZG90LWZsYXNoaW5nIDFzIGluZmluaXRlIGFsdGVybmF0ZTthbmltYXRpb246ZG90LWZsYXNoaW5nIDFzIGluZmluaXRlIGFsdGVybmF0ZTstd2Via2l0LWFuaW1hdGlvbi1kZWxheTowczthbmltYXRpb24tZGVsYXk6MHN9LmRvdC1mbGFzaGluZyAubWlkZGxle21hcmdpbi1sZWZ0OjAuMzc1cmVtO21hcmdpbi1yaWdodDowLjM3NXJlbTstd2Via2l0LWFuaW1hdGlvbjpkb3QtZmxhc2hpbmcgMXMgaW5maW5pdGUgbGluZWFyIGFsdGVybmF0ZTthbmltYXRpb246ZG90LWZsYXNoaW5nIDFzIGluZmluaXRlIGxpbmVhciBhbHRlcm5hdGU7LXdlYmtpdC1hbmltYXRpb24tZGVsYXk6MC41czthbmltYXRpb24tZGVsYXk6MC41c30uZG90LWZsYXNoaW5nIC5yaWdodHstd2Via2l0LWFuaW1hdGlvbjpkb3QtZmxhc2hpbmcgMXMgaW5maW5pdGUgYWx0ZXJuYXRlO2FuaW1hdGlvbjpkb3QtZmxhc2hpbmcgMXMgaW5maW5pdGUgYWx0ZXJuYXRlOy13ZWJraXQtYW5pbWF0aW9uLWRlbGF5OjFzO2FuaW1hdGlvbi1kZWxheToxc31ALXdlYmtpdC1rZXlmcmFtZXMgZG90LWZsYXNoaW5nezAle29wYWNpdHk6MC42NX01MCUsMTAwJXtvcGFjaXR5OjAuMX19QGtleWZyYW1lcyBkb3QtZmxhc2hpbmd7MCV7b3BhY2l0eTowLjY1fTUwJSwxMDAle29wYWNpdHk6MC4xfX06aG9zdHstLXdpZHRoOjI4Ljc1cmVtOy0taGVpZ2h0OjM3LjVyZW07LS1oZWFkZXItY29sb3I6dmFyKC0tYW1wbGlmeS1zZWNvbmRhcnktY29sb3IpOy0taGVhZGVyLXNpemU6dmFyKC0tYW1wbGlmeS10ZXh0LWxnKTstLWJvdC1iYWNrZ3JvdW5kLWNvbG9yOnJnYigyMzAsIDIzMCwgMjMwKTstLWJvdC10ZXh0LWNvbG9yOmJsYWNrOy0tYm90LWRvdC1jb2xvcjp2YXIoLS1ib3QtdGV4dC1jb2xvcik7LS11c2VyLWJhY2tncm91bmQtY29sb3I6dmFyKC0tYW1wbGlmeS1ibHVlKTstLXVzZXItdGV4dC1jb2xvcjp2YXIoLS1hbXBsaWZ5LXdoaXRlKTstLXVzZXItZG90LWNvbG9yOnZhcigtLXVzZXItdGV4dC1jb2xvcil9LmFtcGxpZnktY2hhdGJvdHtkaXNwbGF5Oi1tcy1pbmxpbmUtZmxleGJveDtkaXNwbGF5OmlubGluZS1mbGV4Oy1tcy1mbGV4LWRpcmVjdGlvbjpjb2x1bW47ZmxleC1kaXJlY3Rpb246Y29sdW1uO2JhY2tncm91bmQtY29sb3I6dmFyKC0tYmFja2dyb3VuZC1jb2xvcik7Ym9yZGVyLXJhZGl1czowLjM3NXJlbTstd2Via2l0LWJveC1zaGFkb3c6MC4wNjI1cmVtIDByZW0gMC4yNXJlbSAwIHJnYmEoMCwgMCwgMCwgMC4xNSk7Ym94LXNoYWRvdzowLjA2MjVyZW0gMHJlbSAwLjI1cmVtIDAgcmdiYSgwLCAwLCAwLCAwLjE1KTstd2Via2l0LWJveC1zaXppbmc6Ym9yZGVyLWJveDtib3gtc2l6aW5nOmJvcmRlci1ib3g7Zm9udC1mYW1pbHk6dmFyKC0tYW1wbGlmeS1mb250LWZhbWlseSk7bWFyZ2luLWJvdHRvbToxcmVtO3dpZHRoOjEwMCU7aGVpZ2h0OnZhcigtLWhlaWdodCk7bWF4LXdpZHRoOnZhcigtLXdpZHRoKX1AbWVkaWEgKG1pbi13aWR0aDogNjcycHgpey5hbXBsaWZ5LWNoYXRib3R7d2lkdGg6dmFyKC0td2lkdGgpfX0uaGVhZGVye3BhZGRpbmc6MS4yNXJlbSAwLjM3NXJlbSAxLjI1cmVtIDAuMzc1cmVtO2NvbG9yOnZhcigtLWhlYWRlci1jb2xvcik7Zm9udC1zaXplOnZhcigtLWhlYWRlci1zaXplKTtmb250LXdlaWdodDpib2xkO3RleHQtYWxpZ246Y2VudGVyO3dvcmQtd3JhcDpicmVhay13b3JkfS5ib2R5e2JvcmRlci10b3A6MC4wNjI1cmVtIHNvbGlkIHJnYmEoMCwgMCwgMCwgMC4wNSk7cGFkZGluZzoxLjVyZW0gMXJlbSAwIDFyZW07ZGlzcGxheTotbXMtZmxleGJveDtkaXNwbGF5OmZsZXg7LW1zLWZsZXgtcG9zaXRpdmU6MTtmbGV4LWdyb3c6MTstbXMtZmxleC1kaXJlY3Rpb246Y29sdW1uO2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtvdmVyZmxvdzphdXRvfS5idWJibGV7bWF4LXdpZHRoOjEwMCU7cGFkZGluZzowLjhlbSAxLjRlbTt0ZXh0LWFsaWduOmxlZnQ7d29yZC13cmFwOmJyZWFrLXdvcmQ7bWFyZ2luLWJvdHRvbTowLjYyNXJlbX0uYm90e21hcmdpbi1yaWdodDphdXRvO2JhY2tncm91bmQtY29sb3I6dmFyKC0tYm90LWJhY2tncm91bmQtY29sb3IpO2NvbG9yOnZhcigtLWJvdC10ZXh0LWNvbG9yKTtib3JkZXItcmFkaXVzOjEuNXJlbSAxLjVyZW0gMS41cmVtIDB9LnVzZXJ7bWFyZ2luLWxlZnQ6YXV0bztiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLXVzZXItYmFja2dyb3VuZC1jb2xvcik7Y29sb3I6dmFyKC0tdXNlci10ZXh0LWNvbG9yKTtib3JkZXItcmFkaXVzOjEuNXJlbSAxLjVyZW0gMCAxLjVyZW19LmZvb3RlcntkaXNwbGF5Oi1tcy1mbGV4Ym94O2Rpc3BsYXk6ZmxleDstbXMtZmxleC1hbGlnbjpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO2JvcmRlci10b3A6MC4wNjJyZW0gc29saWQgcmdiYSgwLCAwLCAwLCAwLjA1KTtwYWRkaW5nLXJpZ2h0OjAuNjI1cmVtO21pbi1oZWlnaHQ6My4xMjVyZW19LmZvb3RlciBhbXBsaWZ5LWlucHV0ey0tYm9yZGVyOm5vbmU7LS1tYXJnaW46MDstbXMtZmxleC1wb3NpdGl2ZToxO2ZsZXgtZ3JvdzoxfWNhbnZhc3ttYXJnaW4tbGVmdDowLjYyNXJlbTttYXJnaW4tcmlnaHQ6MC42MjVyZW07LW1zLWZsZXgtcG9zaXRpdmU6MTtmbGV4LWdyb3c6MTtoZWlnaHQ6My4xMjVyZW19Lmljb24tYnV0dG9uey0taWNvbi1oZWlnaHQ6MS4yNXJlbTstLWljb24tZmlsbDp2YXIoLS1hbXBsaWZ5LXByaW1hcnktY29sb3IpOy0tcGFkZGluZzowLjYyNXJlbTstLXdpZHRoOmF1dG99XCI7XG4vLyBlbnVtIGZvciBwb3NzaWJsZSBib3Qgc3RhdGVzXG52YXIgQ2hhdFN0YXRlO1xuKGZ1bmN0aW9uIChDaGF0U3RhdGUpIHtcbiAgICBDaGF0U3RhdGVbQ2hhdFN0YXRlW1wiSW5pdGlhbFwiXSA9IDBdID0gXCJJbml0aWFsXCI7XG4gICAgQ2hhdFN0YXRlW0NoYXRTdGF0ZVtcIkxpc3RlbmluZ1wiXSA9IDFdID0gXCJMaXN0ZW5pbmdcIjtcbiAgICBDaGF0U3RhdGVbQ2hhdFN0YXRlW1wiU2VuZGluZ1RleHRcIl0gPSAyXSA9IFwiU2VuZGluZ1RleHRcIjtcbiAgICBDaGF0U3RhdGVbQ2hhdFN0YXRlW1wiU2VuZGluZ1ZvaWNlXCJdID0gM10gPSBcIlNlbmRpbmdWb2ljZVwiO1xuICAgIENoYXRTdGF0ZVtDaGF0U3RhdGVbXCJFcnJvclwiXSA9IDRdID0gXCJFcnJvclwiO1xufSkoQ2hhdFN0YXRlIHx8IChDaGF0U3RhdGUgPSB7fSkpO1xuLy8gTWVzc2FnZSB0eXBlc1xudmFyIE1lc3NhZ2VGcm9tO1xuKGZ1bmN0aW9uIChNZXNzYWdlRnJvbSkge1xuICAgIE1lc3NhZ2VGcm9tW1wiQm90XCJdID0gXCJib3RcIjtcbiAgICBNZXNzYWdlRnJvbVtcIlVzZXJcIl0gPSBcInVzZXJcIjtcbn0pKE1lc3NhZ2VGcm9tIHx8IChNZXNzYWdlRnJvbSA9IHt9KSk7XG4vLyBFcnJvciB0eXBlc1xudmFyIENoYXRFcnJvclR5cGU7XG4oZnVuY3Rpb24gKENoYXRFcnJvclR5cGUpIHtcbiAgICBDaGF0RXJyb3JUeXBlW0NoYXRFcnJvclR5cGVbXCJSZWNvdmVyYWJsZVwiXSA9IDBdID0gXCJSZWNvdmVyYWJsZVwiO1xuICAgIENoYXRFcnJvclR5cGVbQ2hhdEVycm9yVHlwZVtcIlVucmVjb3ZlcmFibGVcIl0gPSAxXSA9IFwiVW5yZWNvdmVyYWJsZVwiO1xufSkoQ2hhdEVycm9yVHlwZSB8fCAoQ2hhdEVycm9yVHlwZSA9IHt9KSk7XG52YXIgQW1wbGlmeUNoYXRib3QgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gY2xhc3NfMShob3N0UmVmKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIC8qKiBDbGVhciBtZXNzYWdlcyB3aGVuIGNvbnZlcnNhdGlvbiBmaW5pc2hlcyAqL1xuICAgICAgICB0aGlzLmNsZWFyT25Db21wbGV0ZSA9IGZhbHNlO1xuICAgICAgICAvKiogQ29udGludWUgbGlzdGVuaW5nIHRvIHVzZXJzIGFmdGVyIHRoZXkgc2VuZCB0aGUgbWVzc2FnZSAqL1xuICAgICAgICB0aGlzLmNvbnZlcnNhdGlvbk1vZGVPbiA9IGZhbHNlO1xuICAgICAgICAvKiogVGV4dCBwbGFjZWQgaW4gdGhlIHRvcCBoZWFkZXIgKi9cbiAgICAgICAgdGhpcy5ib3RUaXRsZSA9IFRyYW5zbGF0aW9ucy5DSEFUQk9UX1RJVExFO1xuICAgICAgICAvKiogV2hldGhlciB2b2ljZSBjaGF0IGlzIGVuYWJsZWQgKi9cbiAgICAgICAgdGhpcy52b2ljZUVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgLyoqIFdoZXRoZXIgdGV4dCBjaGF0IGlzIGVuYWJsZWQgKi9cbiAgICAgICAgdGhpcy50ZXh0RW5hYmxlZCA9IHRydWU7XG4gICAgICAgIC8qKiBBbW91bnQgb2Ygc2lsZW5jZSAoaW4gbXMpIHRvIHdhaXQgZm9yICovXG4gICAgICAgIHRoaXMuc2lsZW5jZVRpbWUgPSAxNTAwO1xuICAgICAgICAvKiogTm9pc2UgdGhyZXNob2xkIGJldHdlZW4gLTEgYW5kIDEuIEFueXRoaW5nIGJlbG93IGlzIGNvbnNpZGVyZWQgYSBzaWxlbmNlLiAqL1xuICAgICAgICB0aGlzLnNpbGVuY2VUaHJlc2hvbGQgPSAwLjI7XG4gICAgICAgIC8qKiBNZXNzYWdlcyBpbiBjdXJyZW50IHNlc3Npb24gKi9cbiAgICAgICAgdGhpcy5tZXNzYWdlcyA9IFtdO1xuICAgICAgICAvKiogVGV4dCBpbnB1dCBib3ggdmFsdWUgICovXG4gICAgICAgIHRoaXMudGV4dCA9ICcnO1xuICAgICAgICAvKiogQ3VycmVudCBhcHAgc3RhdGUgKi9cbiAgICAgICAgdGhpcy5jaGF0U3RhdGUgPSBDaGF0U3RhdGUuSW5pdGlhbDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbmRlcmluZyBtZXRob2RzXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1lc3NhZ2VKU1ggPSBmdW5jdGlvbiAobWVzc2FnZXMpIHtcbiAgICAgICAgICAgIHZhciBtZXNzYWdlTGlzdCA9IG1lc3NhZ2VzLm1hcChmdW5jdGlvbiAobWVzc2FnZSkgeyByZXR1cm4gaChcImRpdlwiLCB7IGNsYXNzOiBcImJ1YmJsZSBcIiArIG1lc3NhZ2UuZnJvbSB9LCBtZXNzYWdlLmNvbnRlbnQpOyB9KTtcbiAgICAgICAgICAgIGlmIChfdGhpcy5jaGF0U3RhdGUgPT09IENoYXRTdGF0ZS5TZW5kaW5nVGV4dCB8fCBfdGhpcy5jaGF0U3RhdGUgPT09IENoYXRTdGF0ZS5TZW5kaW5nVm9pY2UpIHtcbiAgICAgICAgICAgICAgICAvLyBpZiB3YWl0aW5nIGZvciB2b2ljZSBtZXNzYWdlLCBzaG93IGFuaW1hdGlvbiBvbiB1c2VyIHNpZGUgYmVjYXVzZSBhcHAgaXMgd2FpdGluZyBmb3IgdHJhbnNjcmlwdC4gRWxzZSBwdXQgaXQgb24gYm90IHNpZGUuXG4gICAgICAgICAgICAgICAgdmFyIGNsaWVudCA9IF90aGlzLmNoYXRTdGF0ZSA9PT0gQ2hhdFN0YXRlLlNlbmRpbmdUZXh0ID8gTWVzc2FnZUZyb20uQm90IDogTWVzc2FnZUZyb20uVXNlcjtcbiAgICAgICAgICAgICAgICBtZXNzYWdlTGlzdC5wdXNoKGgoXCJkaXZcIiwgeyBjbGFzczogXCJidWJibGUgXCIgKyBjbGllbnQgfSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImRvdC1mbGFzaGluZyBcIiArIGNsaWVudCB9LCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImRvdCBsZWZ0XCIgfSksIGgoXCJzcGFuXCIsIHsgY2xhc3M6IFwiZG90IG1pZGRsZVwiIH0pLCBoKFwic3BhblwiLCB7IGNsYXNzOiBcImRvdCByaWdodFwiIH0pKSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2VMaXN0O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNoYXRDb21wbGV0ZWQgPSBjcmVhdGVFdmVudCh0aGlzLCBcImNoYXRDb21wbGV0ZWRcIiwgNyk7XG4gICAgfVxuICAgIC8vIE9jY3VycyB3aGVuIHVzZXIgcHJlc3NlcyBlbnRlciBpbiBpbnB1dCBib3hcbiAgICBjbGFzc18xLnByb3RvdHlwZS5zdWJtaXRIYW5kbGVyID0gZnVuY3Rpb24gKF9ldmVudCkge1xuICAgICAgICB0aGlzLnNlbmRUZXh0TWVzc2FnZSgpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogTGlmZWN5Y2xlIGZ1bmN0aW9uc1xuICAgICAqL1xuICAgIGNsYXNzXzEucHJvdG90eXBlLmNvbXBvbmVudFdpbGxMb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIUludGVyYWN0aW9ucyB8fCB0eXBlb2YgSW50ZXJhY3Rpb25zLm9uQ29tcGxldGUgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihOT19JTlRFUkFDVElPTlNfTU9EVUxFX0ZPVU5EKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZhbGlkYXRlUHJvcHMoKTtcbiAgICB9O1xuICAgIGNsYXNzXzEucHJvdG90eXBlLmNvbXBvbmVudERpZFJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gc2Nyb2xsIHRvIHRoZSBib3R0b20gaWYgbmVjZXNzYXJ5XG4gICAgICAgIHZhciBib2R5ID0gdGhpcy5lbGVtZW50LnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcignLmJvZHknKTtcbiAgICAgICAgYm9keS5zY3JvbGxUb3AgPSBib2R5LnNjcm9sbEhlaWdodDtcbiAgICB9O1xuICAgIGNsYXNzXzEucHJvdG90eXBlLnZhbGlkYXRlUHJvcHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICghdGhpcy52b2ljZUVuYWJsZWQgJiYgIXRoaXMudGV4dEVuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0RXJyb3IoVHJhbnNsYXRpb25zLkNIQVRfRElTQUJMRURfRVJST1IsIENoYXRFcnJvclR5cGUuVW5yZWNvdmVyYWJsZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIXRoaXMuYm90TmFtZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRFcnJvcihUcmFuc2xhdGlvbnMuTk9fQk9UX05BTUVfRVJST1IsIENoYXRFcnJvclR5cGUuVW5yZWNvdmVyYWJsZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMud2VsY29tZU1lc3NhZ2UpXG4gICAgICAgICAgICB0aGlzLmFwcGVuZFRvQ2hhdCh0aGlzLndlbGNvbWVNZXNzYWdlLCBNZXNzYWdlRnJvbS5Cb3QpO1xuICAgICAgICAvLyBJbml0aWFsaXplIEF1ZGlvUmVjb3JkZXIgaWYgdm9pY2UgaXMgZW5hYmxlZFxuICAgICAgICBpZiAodGhpcy52b2ljZUVuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYXVkaW9SZWNvcmRlciA9IG5ldyBBdWRpb1JlY29yZGVyKHtcbiAgICAgICAgICAgICAgICB0aW1lOiB0aGlzLnNpbGVuY2VUaW1lLFxuICAgICAgICAgICAgICAgIGFtcGxpdHVkZTogdGhpcy5zaWxlbmNlVGhyZXNob2xkLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmF1ZGlvUmVjb3JkZXIuaW5pdCgpLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5zZXRFcnJvcihlcnIsIENoYXRFcnJvclR5cGUuUmVjb3ZlcmFibGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGFmdGVyIGNoYXQgaXMgY29tcGxldGVkXG4gICAgICAgIHZhciBvbkNvbXBsZXRlID0gZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgICAgICAgX3RoaXMuY2hhdENvbXBsZXRlZC5lbWl0KHtcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgIGVycjogZXJyLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoX3RoaXMuY2xlYXJPbkNvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMucmVzZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIF90aGlzLmNoYXRTdGF0ZSA9IENoYXRTdGF0ZS5Jbml0aWFsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgSW50ZXJhY3Rpb25zLm9uQ29tcGxldGUodGhpcy5ib3ROYW1lLCBvbkNvbXBsZXRlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICB0aGlzLnNldEVycm9yKGVyciwgQ2hhdEVycm9yVHlwZS5VbnJlY292ZXJhYmxlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogSGFuZGxlcnNcbiAgICAgKi9cbiAgICBjbGFzc18xLnByb3RvdHlwZS5oYW5kbGVNaWNCdXR0b24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICh0aGlzLmNoYXRTdGF0ZSAhPT0gQ2hhdFN0YXRlLkluaXRpYWwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuYXVkaW9SZWNvcmRlci5zdG9wKCk7XG4gICAgICAgIHRoaXMuY2hhdFN0YXRlID0gQ2hhdFN0YXRlLkxpc3RlbmluZztcbiAgICAgICAgdGhpcy5hdWRpb1JlY29yZGVyLnN0YXJ0UmVjb3JkaW5nKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmhhbmRsZVNpbGVuY2UoKTsgfSwgZnVuY3Rpb24gKGRhdGEsIGxlbmd0aCkgeyByZXR1cm4gX3RoaXMudmlzdWFsaXplcihkYXRhLCBsZW5ndGgpOyB9KTtcbiAgICB9O1xuICAgIGNsYXNzXzEucHJvdG90eXBlLmhhbmRsZVNpbGVuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuY2hhdFN0YXRlID0gQ2hhdFN0YXRlLlNlbmRpbmdWb2ljZTtcbiAgICAgICAgdGhpcy5hdWRpb1JlY29yZGVyLnN0b3BSZWNvcmRpbmcoKTtcbiAgICAgICAgdGhpcy5hdWRpb1JlY29yZGVyLmV4cG9ydFdBVigpLnRoZW4oZnVuY3Rpb24gKGJsb2IpIHtcbiAgICAgICAgICAgIF90aGlzLnNlbmRWb2ljZU1lc3NhZ2UoYmxvYik7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgY2xhc3NfMS5wcm90b3R5cGUuaGFuZGxlVGV4dENoYW5nZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICB0aGlzLnRleHQgPSB0YXJnZXQudmFsdWU7XG4gICAgfTtcbiAgICBjbGFzc18xLnByb3RvdHlwZS5oYW5kbGVDYW5jZWxCdXR0b24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuYXVkaW9SZWNvcmRlci5jbGVhcigpO1xuICAgICAgICB0aGlzLmNoYXRTdGF0ZSA9IENoYXRTdGF0ZS5Jbml0aWFsO1xuICAgIH07XG4gICAgY2xhc3NfMS5wcm90b3R5cGUuaGFuZGxlVG9hc3RDbG9zZSA9IGZ1bmN0aW9uIChlcnJvclR5cGUpIHtcbiAgICAgICAgdGhpcy5lcnJvciA9IHVuZGVmaW5lZDsgLy8gY2xlYXIgZXJyb3JcbiAgICAgICAgLy8gaWYgZXJyb3IgaXMgcmVjb3ZlcmFibGUsIHJlc2V0IHRoZSBhcHAgc3RhdGUgdG8gaW5pdGlhbFxuICAgICAgICBpZiAoZXJyb3JUeXBlID09PSBDaGF0RXJyb3JUeXBlLlJlY292ZXJhYmxlKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXRTdGF0ZSA9IENoYXRTdGF0ZS5Jbml0aWFsO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBWaXN1YWxpemF0aW9uXG4gICAgICovXG4gICAgY2xhc3NfMS5wcm90b3R5cGUudmlzdWFsaXplciA9IGZ1bmN0aW9uIChkYXRhQXJyYXksIGJ1ZmZlckxlbmd0aCkge1xuICAgICAgICB2YXIgY2FudmFzID0gdGhpcy5lbGVtZW50LnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcignY2FudmFzJyk7XG4gICAgICAgIHZpc3VhbGl6ZShkYXRhQXJyYXksIGJ1ZmZlckxlbmd0aCwgY2FudmFzKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEludGVyYWN0aW9ucyBoZWxwZXJzXG4gICAgICovXG4gICAgY2xhc3NfMS5wcm90b3R5cGUuc2VuZFRleHRNZXNzYWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGV4dCwgcmVzcG9uc2UsIGVycl8zO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudGV4dC5sZW5ndGggPT09IDAgfHwgdGhpcy5jaGF0U3RhdGUgIT09IENoYXRTdGF0ZS5Jbml0aWFsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSB0aGlzLnRleHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHQgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kVG9DaGF0KHRleHQsIE1lc3NhZ2VGcm9tLlVzZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGF0U3RhdGUgPSBDaGF0U3RhdGUuU2VuZGluZ1RleHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnRyeXMucHVzaChbMSwgMywgLCA0XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBJbnRlcmFjdGlvbnMuc2VuZCh0aGlzLmJvdE5hbWUsIHRleHQpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyXzMgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVycm9yKGVycl8zLCBDaGF0RXJyb3JUeXBlLlJlY292ZXJhYmxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZFRvQ2hhdChyZXNwb25zZS5tZXNzYWdlLCBNZXNzYWdlRnJvbS5Cb3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGF0U3RhdGUgPSBDaGF0U3RhdGUuSW5pdGlhbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjbGFzc18xLnByb3RvdHlwZS5zZW5kVm9pY2VNZXNzYWdlID0gZnVuY3Rpb24gKGF1ZGlvSW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGludGVyYWN0aW9uc01lc3NhZ2UsIHJlc3BvbnNlLCBlcnJfNCwgZGlhbG9nU3RhdGU7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJhY3Rpb25zTWVzc2FnZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBhdWRpb0lucHV0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVR5cGU6ICd2b2ljZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnRyeXMucHVzaChbMSwgMywgLCA0XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBJbnRlcmFjdGlvbnMuc2VuZCh0aGlzLmJvdE5hbWUsIGludGVyYWN0aW9uc01lc3NhZ2UpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyXzQgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVycm9yKGVycl80LCBDaGF0RXJyb3JUeXBlLlJlY292ZXJhYmxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGF0U3RhdGUgPSBDaGF0U3RhdGUuSW5pdGlhbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ1N0YXRlID0gcmVzcG9uc2UuZGlhbG9nU3RhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuaW5wdXRUcmFuc2NyaXB0KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kVG9DaGF0KHJlc3BvbnNlLmlucHV0VHJhbnNjcmlwdCwgTWVzc2FnZUZyb20uVXNlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZFRvQ2hhdChyZXNwb25zZS5tZXNzYWdlLCBNZXNzYWdlRnJvbS5Cb3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5hdWRpb1JlY29yZGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wbGF5KHJlc3BvbnNlLmF1ZGlvU3RyZWFtKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIGNvbnZlcnNhdGlvbk1vZGUgaXMgb24sIGNoYXQgaXMgaW5jb21wbGV0ZSwgYW5kIG1pYyBidXR0b24gaXNuJ3QgcHJlc3NlZCB5ZXQsIHJlc3VtZSBsaXN0ZW5pbmcuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5jb252ZXJzYXRpb25Nb2RlT24gJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ1N0YXRlICE9PSAnRnVsZmlsbGVkJyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nU3RhdGUgIT09ICdGYWlsZWQnICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jaGF0U3RhdGUgPT09IENoYXRTdGF0ZS5Jbml0aWFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVNaWNCdXR0b24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7IHJldHVybiBfdGhpcy5zZXRFcnJvcihlcnIsIENoYXRFcnJvclR5cGUuUmVjb3ZlcmFibGUpOyB9KV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjbGFzc18xLnByb3RvdHlwZS5hcHBlbmRUb0NoYXQgPSBmdW5jdGlvbiAoY29udGVudCwgZnJvbSkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gX19zcHJlYWRBcnJheXModGhpcy5tZXNzYWdlcywgW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnQsXG4gICAgICAgICAgICAgICAgZnJvbTogZnJvbSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogU3RhdGUgY29udHJvbCBtZXRob2RzXG4gICAgICovXG4gICAgY2xhc3NfMS5wcm90b3R5cGUuc2V0RXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IsIGVycm9yVHlwZSkge1xuICAgICAgICB2YXIgbWVzc2FnZSA9IHR5cGVvZiBlcnJvciA9PT0gJ3N0cmluZycgPyBlcnJvciA6IGVycm9yLm1lc3NhZ2U7XG4gICAgICAgIHRoaXMuY2hhdFN0YXRlID0gQ2hhdFN0YXRlLkVycm9yO1xuICAgICAgICB0aGlzLmVycm9yID0geyBtZXNzYWdlOiBtZXNzYWdlLCBlcnJvclR5cGU6IGVycm9yVHlwZSB9O1xuICAgIH07XG4gICAgY2xhc3NfMS5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY2hhdFN0YXRlID0gQ2hhdFN0YXRlLkluaXRpYWw7XG4gICAgICAgIHRoaXMudGV4dCA9ICcnO1xuICAgICAgICB0aGlzLmVycm9yID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gW107XG4gICAgICAgIGlmICh0aGlzLndlbGNvbWVNZXNzYWdlKVxuICAgICAgICAgICAgdGhpcy5hcHBlbmRUb0NoYXQodGhpcy53ZWxjb21lTWVzc2FnZSwgTWVzc2FnZUZyb20uQm90KTtcbiAgICAgICAgdGhpcy5hdWRpb1JlY29yZGVyICYmIHRoaXMuYXVkaW9SZWNvcmRlci5jbGVhcigpO1xuICAgIH07XG4gICAgY2xhc3NfMS5wcm90b3R5cGUubGlzdGVuaW5nRm9vdGVySlNYID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgdmlzdWFsaXphdGlvbiA9IGgoXCJjYW52YXNcIiwgeyBoZWlnaHQ6IFwiNTBcIiB9KTtcbiAgICAgICAgdmFyIGNhbmNlbEJ1dHRvbiA9IChoKFwiYW1wbGlmeS1idXR0b25cIiwgeyBcImRhdGEtdGVzdFwiOiBcImNoYXRib3QtY2FuY2VsLWJ1dHRvblwiLCBoYW5kbGVCdXR0b25DbGljazogZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuaGFuZGxlQ2FuY2VsQnV0dG9uKCk7IH0sIGNsYXNzOiBcImljb24tYnV0dG9uXCIsIHZhcmlhbnQ6IFwiaWNvblwiLCBpY29uOiBcImJhblwiIH0pKTtcbiAgICAgICAgcmV0dXJuIFt2aXN1YWxpemF0aW9uLCBjYW5jZWxCdXR0b25dO1xuICAgIH07XG4gICAgY2xhc3NfMS5wcm90b3R5cGUuZm9vdGVySlNYID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5jaGF0U3RhdGUgPT09IENoYXRTdGF0ZS5MaXN0ZW5pbmcpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5saXN0ZW5pbmdGb290ZXJKU1goKTtcbiAgICAgICAgdmFyIGlucHV0UGxhY2Vob2xkZXIgPSB0aGlzLnRleHRFbmFibGVkXG4gICAgICAgICAgICA/IFRyYW5zbGF0aW9ucy5URVhUX0lOUFVUX1BMQUNFSE9MREVSXG4gICAgICAgICAgICA6IFRyYW5zbGF0aW9ucy5WT0lDRV9JTlBVVF9QTEFDRUhPTERFUjtcbiAgICAgICAgdmFyIHRleHRJbnB1dCA9IChoKFwiYW1wbGlmeS1pbnB1dFwiLCB7IHBsYWNlaG9sZGVyOiBJMThuLmdldChpbnB1dFBsYWNlaG9sZGVyKSwgZGVzY3JpcHRpb246IFwidGV4dFwiLCBoYW5kbGVJbnB1dENoYW5nZTogZnVuY3Rpb24gKGV2dCkgeyByZXR1cm4gX3RoaXMuaGFuZGxlVGV4dENoYW5nZShldnQpOyB9LCB2YWx1ZTogdGhpcy50ZXh0LCBkaXNhYmxlZDogdGhpcy5jaGF0U3RhdGUgPT09IENoYXRTdGF0ZS5FcnJvciB8fCAhdGhpcy50ZXh0RW5hYmxlZCB9KSk7XG4gICAgICAgIHZhciBtaWNCdXR0b24gPSB0aGlzLnZvaWNlRW5hYmxlZCAmJiAoaChcImFtcGxpZnktYnV0dG9uXCIsIHsgXCJkYXRhLXRlc3RcIjogXCJjaGF0Ym90LW1pYy1idXR0b25cIiwgaGFuZGxlQnV0dG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmhhbmRsZU1pY0J1dHRvbigpOyB9LCBjbGFzczogXCJpY29uLWJ1dHRvblwiLCB2YXJpYW50OiBcImljb25cIiwgaWNvbjogXCJtaWNyb3Bob25lXCIsIGRpc2FibGVkOiB0aGlzLmNoYXRTdGF0ZSA9PT0gQ2hhdFN0YXRlLkVycm9yIHx8IHRoaXMuY2hhdFN0YXRlICE9PSBDaGF0U3RhdGUuSW5pdGlhbCB9KSk7XG4gICAgICAgIHZhciBzZW5kQnV0dG9uID0gdGhpcy50ZXh0RW5hYmxlZCAmJiAoaChcImFtcGxpZnktYnV0dG9uXCIsIHsgXCJkYXRhLXRlc3RcIjogXCJjaGF0Ym90LXNlbmQtYnV0dG9uXCIsIGNsYXNzOiBcImljb24tYnV0dG9uXCIsIHZhcmlhbnQ6IFwiaWNvblwiLCBpY29uOiBcInNlbmRcIiwgaGFuZGxlQnV0dG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnNlbmRUZXh0TWVzc2FnZSgpOyB9LCBkaXNhYmxlZDogdGhpcy5jaGF0U3RhdGUgPT09IENoYXRTdGF0ZS5FcnJvciB8fCB0aGlzLmNoYXRTdGF0ZSAhPT0gQ2hhdFN0YXRlLkluaXRpYWwgfSkpO1xuICAgICAgICByZXR1cm4gW3RleHRJbnB1dCwgbWljQnV0dG9uLCBzZW5kQnV0dG9uXTtcbiAgICB9O1xuICAgIGNsYXNzXzEucHJvdG90eXBlLmVycm9yVG9hc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICghdGhpcy5lcnJvcilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdmFyIF9hID0gdGhpcy5lcnJvciwgbWVzc2FnZSA9IF9hLm1lc3NhZ2UsIGVycm9yVHlwZSA9IF9hLmVycm9yVHlwZTtcbiAgICAgICAgcmV0dXJuIGgoXCJhbXBsaWZ5LXRvYXN0XCIsIHsgbWVzc2FnZTogSTE4bi5nZXQobWVzc2FnZSksIGhhbmRsZUNsb3NlOiBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5oYW5kbGVUb2FzdENsb3NlKGVycm9yVHlwZSk7IH0gfSk7XG4gICAgfTtcbiAgICBjbGFzc18xLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoaChIb3N0LCBudWxsLCBoKFwiZGl2XCIsIHsgY2xhc3M6IFwiYW1wbGlmeS1jaGF0Ym90XCIgfSwgaChcInNsb3RcIiwgeyBuYW1lOiBcImhlYWRlclwiIH0sIGgoXCJkaXZcIiwgeyBjbGFzczogXCJoZWFkZXJcIiwgXCJkYXRhLXRlc3RcIjogXCJjaGF0Ym90LWhlYWRlclwiIH0sIEkxOG4uZ2V0KHRoaXMuYm90VGl0bGUpKSksIGgoXCJkaXZcIiwgeyBjbGFzczogXCJib2R5XCIsIFwiZGF0YS10ZXN0XCI6IFwiY2hhdGJvdC1ib2R5XCIgfSwgdGhpcy5tZXNzYWdlSlNYKHRoaXMubWVzc2FnZXMpKSwgaChcImRpdlwiLCB7IGNsYXNzOiBcImZvb3RlclwiLCBcImRhdGEtdGVzdFwiOiBcImNoYXRib3QtZm9vdGVyXCIgfSwgdGhpcy5mb290ZXJKU1goKSksIHRoaXMuZXJyb3JUb2FzdCgpKSkpO1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNsYXNzXzEucHJvdG90eXBlLCBcImVsZW1lbnRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gY2xhc3NfMTtcbn0oKSk7XG5BbXBsaWZ5Q2hhdGJvdC5zdHlsZSA9IGFtcGxpZnlDaGF0Ym90Q3NzO1xuZXhwb3J0IHsgQW1wbGlmeUNoYXRib3QgYXMgYW1wbGlmeV9jaGF0Ym90IH07XG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/@aws-amplify/ui-components/dist/esm-es5/amplify-chatbot.entry.js\n");

/***/ })

}]);